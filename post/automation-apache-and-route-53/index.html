<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title>Automation: Apache and Route 53 - Dave's DevOps blog</title>
<meta name=renderer content="webkit">
<meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes">
<meta name=MobileOptimized content="width">
<meta name=HandheldFriendly content="true">
<meta name=applicable-device content="pc,mobile">
<meta name=theme-color content="#f8f5ec">
<meta name=msapplication-navbutton-color content="#f8f5ec">
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec">
<meta name=mobile-web-app-capable content="yes">
<meta name=author content="Dave">
<meta name=description content="This solution consisted of a Route53 hosted zone with A-records directing traffic to an AWS EIP (Elastic IP Address) hosted on a firewall appliance (Fortinet). The firewall had a VIP rule to forward requests received on that EIP to the Apache reverse proxy.
A regular activity I had to perform for one of my clients was setting up apache reverse proxy services for their development environments. This involved defining a subdomain name for an application, creating an A-record on AWS Route53 and then configuring the rewrite rules which varied per application type.">
<meta name=keywords content="Hugo,theme,jane">
<meta name=generator content="Hugo 0.88.0">
<link rel=canonical href=https://daveihart.github.io/davehart.co.uk/post/automation-apache-and-route-53/>
<link rel=icon href=/davehart.co.uk/favicon.ico>
<link rel=stylesheet href=/davehart.co.uk/sass/jane.min.fa4b2b9f31b5c6d0b683db81157a9226e17b06e61911791ab547242a4a0556f2.css integrity="sha256-+ksrnzG1xtC2g9uBFXqSJuF7BuYZEXkatUckKkoFVvI=" media=screen crossorigin=anonymous>
<meta property="og:title" content="Automation: Apache and Route 53">
<meta property="og:description" content="This solution consisted of a Route53 hosted zone with A-records directing traffic to an AWS EIP (Elastic IP Address) hosted on a firewall appliance (Fortinet). The firewall had a VIP rule to forward requests received on that EIP to the Apache reverse proxy.
A regular activity I had to perform for one of my clients was setting up apache reverse proxy services for their development environments. This involved defining a subdomain name for an application, creating an A-record on AWS Route53 and then configuring the rewrite rules which varied per application type.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://daveihart.github.io/davehart.co.uk/post/automation-apache-and-route-53/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2021-01-15T16:04:10+00:00">
<meta property="article:modified_time" content="2021-01-15T16:04:10+00:00">
<meta itemprop=name content="Automation: Apache and Route 53">
<meta itemprop=description content="This solution consisted of a Route53 hosted zone with A-records directing traffic to an AWS EIP (Elastic IP Address) hosted on a firewall appliance (Fortinet). The firewall had a VIP rule to forward requests received on that EIP to the Apache reverse proxy.
A regular activity I had to perform for one of my clients was setting up apache reverse proxy services for their development environments. This involved defining a subdomain name for an application, creating an A-record on AWS Route53 and then configuring the rewrite rules which varied per application type."><meta itemprop=datePublished content="2021-01-15T16:04:10+00:00">
<meta itemprop=dateModified content="2021-01-15T16:04:10+00:00">
<meta itemprop=wordCount content="2784">
<meta itemprop=keywords content="Amazon Linux,apache,Apache,AWS,AWS,Blog,cli,cli,GitHub,linux,route53,shell,shellscript,"><meta name=twitter:card content="summary">
<meta name=twitter:title content="Automation: Apache and Route 53">
<meta name=twitter:description content="This solution consisted of a Route53 hosted zone with A-records directing traffic to an AWS EIP (Elastic IP Address) hosted on a firewall appliance (Fortinet). The firewall had a VIP rule to forward requests received on that EIP to the Apache reverse proxy.
A regular activity I had to perform for one of my clients was setting up apache reverse proxy services for their development environments. This involved defining a subdomain name for an application, creating an A-record on AWS Route53 and then configuring the rewrite rules which varied per application type."><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]-->
</head>
<body>
<div id=mobile-navbar class=mobile-navbar>
<div class=mobile-header-logo>
<a href=/davehart.co.uk/ class=logo>Dave's blog</a>
</div>
<div class=mobile-navbar-icon>
<span></span>
<span></span>
<span></span>
</div>
</div>
<nav id=mobile-menu class="mobile-menu slideout-menu">
<ul class=mobile-menu-list>
<li class=mobile-menu-item>
<a class=menu-item-link href=https://daveihart.github.io/davehart.co.uk/>Home</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://daveihart.github.io/davehart.co.uk/post/>Posts</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://daveihart.github.io/davehart.co.uk/tags/>Tags</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://daveihart.github.io/davehart.co.uk/about/about/>About</a>
</li>
</ul>
</nav>
<link rel=stylesheet href=/davehart.co.uk/lib/photoswipe/photoswipe.min.css>
<link rel=stylesheet href=/davehart.co.uk/lib/photoswipe/default-skin/default-skin.min.css>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div>
<header id=header class="header container">
<div class=logo-wrapper>
<a href=/davehart.co.uk/ class=logo>
Dave's blog
</a>
</div>
<nav class=site-navbar>
<ul id=menu class=menu>
<li class=menu-item>
<a class=menu-item-link href=https://daveihart.github.io/davehart.co.uk/>Home</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://daveihart.github.io/davehart.co.uk/post/>Posts</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://daveihart.github.io/davehart.co.uk/tags/>Tags</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://daveihart.github.io/davehart.co.uk/about/about/>About</a>
</li>
</ul>
</nav>
</header>
<div id=mobile-panel>
<main id=main class="main bg-llight">
<div class=content-wrapper>
<div id=content class="content container">
<article class="post bg-white">
<header class=post-header>
<h1 class=post-title>Automation: Apache and Route 53</h1>
<div class=post-meta>
<time datetime=2021-01-15 class=post-time>
2021-01-15
</time>
<span class=more-meta> 2784 words </span>
<span class=more-meta> 14 min read </span>
</div>
</header>
<div class=post-toc id=post-toc>
<h2 class=post-toc-title>Table of Contents</h2>
<div class=post-toc-content>
<nav id=TableOfContents>
<ul>
<li><a href=#method>Method</a></li>
<li><a href=#considerations>Considerations</a></li>
<li><a href=#process-flow>Process Flow</a></li>
<li><a href=#setting-the-scene>Setting the scene</a></li>
<li><a href=#aws-roles>AWS Roles</a></li>
<li><a href=#authorised-user>Authorised user</a></li>
<li><a href=#passing-environment-variables>Passing environment variables</a>
<ul>
<li><a href=#sendenv>SendEnv</a></li>
</ul>
</li>
<li><a href=#script>Script</a>
<ul>
<li><a href=#declarations>Declarations</a></li>
</ul>
</li>
<li><a href=#functions>Functions</a>
<ul>
<li><a href=#validate_app>validate_app</a></li>
<li><a href=#build_record>build_record</a></li>
<li><a href=#check_conf_d>check_conf_d</a></li>
<li><a href=#update_route53>update_route53</a></li>
<li><a href=#build_proxy_rule>build_proxy_rule</a></li>
<li><a href=#restart_service>restart_service</a></li>
<li><a href=#main>Main</a></li>
</ul>
</li>
<li><a href=#conclusion>Conclusion</a></li>
</ul>
</nav>
</div>
</div>
<div class=post-content>
<p>This solution consisted of a Route53 hosted zone with A-records directing traffic to an AWS EIP (Elastic IP Address) hosted on a firewall appliance (Fortinet). The firewall had a VIP rule to forward requests received on that EIP to the Apache reverse proxy.</p>
<p>A regular activity I had to perform for one of my clients was setting up apache reverse proxy services for their development environments. This involved defining a subdomain name for an application, creating an A-record on AWS Route53 and then configuring the rewrite rules which varied per application type. Lets look at how it was automated.</p>
<h2 id=method>Method</h2>
<p>To achieve the automation flow we needed to understand each component in the process and how we could automate it. First up was the AWS Route53 hosted zone, this should be easy using the AWS cli. Second was the firewall, as the method used would create a new child domain to the existing domain the current firewall VIP rule was fine, no change there. Lastly was the RHEL Apache server which could be updated with some bash code by adding a new rewrite rule. All of this could be kicked off from a <a href=https://www.gocd.org/>gocd</a> pipeline with a few variables.</p>
<h2 id=considerations>Considerations</h2>
<p>As the code would be interacting with AWS resources (Route53 in this case), it would be advisable to introduce an IAM role to grant the server access to update the Route53 rules. The gocd agent server could be used by multiple teams so I decided to assign the roles to the Apache proxy server which was in my teams support alongside the AWS infrastructure. This did mean I needed to workout how to pass environment variables from the gocd server to the apache server. Once the variables needed by the code were available on the apache server the processing could all be performed there.</p>
<h2 id=process-flow>Process Flow</h2>
<p>This is what the processing would look like</p>
<p><img src=/image//2020/12/image2.png alt></p>
<h2 id=setting-the-scene>Setting the scene</h2>
<p>A number of activities had to be performed to prepare the environment for this type of automation activity. The apache server was configured to use a single httpd.conf file with all the rules within. This would be a pain to append a new rule each time. As such I changed the server to use individual rewrite rule conf files located in the /etc/httpd/conf.d folder. Each rewrite rule had its own file. This made the process more granular and if and when I made a remove rule process it would be less risky.</p>
<p>In addition to the above, I also had to define some limitations on the rewrite rules being created. There were three distinct application rewrite configurations so the process would have to include an application type variable. If it did not fit in the agreed application types then it would not execute. These three types could then be defined as templates within the code and would also used in working out the child domain name and suffix (numeric value)</p>
<h2 id=aws-roles>AWS Roles</h2>
<p>A role was created to allow the apache server access to manage AWS Route 53. This was attached to the ec2 instance hosting the apache service.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>{
    &#34;Version&#34;: &#34;2012-10-17&#34;,
    &#34;Statement&#34;: \[
        {
            &#34;Sid&#34;: &#34;VisualEditor0&#34;,
            &#34;Effect&#34;: &#34;Allow&#34;,
            &#34;Action&#34;: \[
                &#34;route53:ListTrafficPolicyInstances&#34;,
                &#34;route53:GetTrafficPolicyInstanceCount&#34;,
                &#34;route53:GetChange&#34;,
                &#34;route53:ListTrafficPolicyVersions&#34;,
                &#34;route53:TestDNSAnswer&#34;,
                &#34;route53:GetHostedZone&#34;,
                &#34;route53:GetHealthCheck&#34;,
                &#34;route53:ListHostedZonesByName&#34;,
                &#34;route53:ListQueryLoggingConfigs&#34;,
                &#34;route53:GetCheckerIpRanges&#34;,
                &#34;route53:ListTrafficPolicies&#34;,
                &#34;route53:ListResourceRecordSets&#34;,
                &#34;route53:ListGeoLocations&#34;,
                &#34;route53:GetTrafficPolicyInstance&#34;,
                &#34;route53:GetHostedZoneCount&#34;,
                &#34;route53:GetHealthCheckCount&#34;,
                &#34;route53:GetQueryLoggingConfig&#34;,
                &#34;route53:ListReusableDelegationSets&#34;,
                &#34;route53:GetHealthCheckLastFailureReason&#34;,
                &#34;route53:GetHealthCheckStatus&#34;,
                &#34;route53:ListTrafficPolicyInstancesByHostedZone&#34;,
                &#34;route53:ListHostedZones&#34;,
                &#34;route53:ListVPCAssociationAuthorizations&#34;,
                &#34;route53:GetReusableDelegationSetLimit&#34;,
                &#34;route53:ChangeResourceRecordSets&#34;,
                &#34;route53:GetReusableDelegationSet&#34;,
                &#34;route53:ListTagsForResource&#34;,
                &#34;route53:ListTagsForResources&#34;,
                &#34;route53:GetAccountLimit&#34;,
                &#34;route53:ListTrafficPolicyInstancesByPolicy&#34;,
                &#34;route53:ListHealthChecks&#34;,
                &#34;route53:GetGeoLocation&#34;,
                &#34;route53:GetHostedZoneLimit&#34;,
                &#34;route53:GetTrafficPolicy&#34;
            \],
            &#34;Resource&#34;: &#34;\*&#34;
        }
    \]
}
</code></pre></td></tr></table>
</div>
</div><h2 id=authorised-user>Authorised user</h2>
<p>I defined a new key pair on the apache server for the automation activity which could be passed to the deployment teams for their pipelines.</p>
<p>The new key pair was generated using ssh-keygen. The public key generated was then added to the machines authorized_keys file and the private key used in the pipeline.</p>
<p>Generate a public and private key pair.</p>
<p><img src=/image//2021/01/image-21.png alt></p>
<p>Once we have our key pair we need to copy the public part (filename.pub) into the ~/.ssh/authorized_keys file</p>
<p><img src=/image//2021/01/image-31.png alt></p>
<p><img src=/image//2021/01/image-41.png alt></p>
<p>In the above screenshot you can see the default public key for the user and the newly generated example key. The private part of the key can now be passed to the deployment team for them to use in their pipeline.</p>
<p>You will need to ensure that the automation account has sufficient file level permissions to update apache and store any backup etc. generated by the script.</p>
<h2 id=passing-environment-variables>Passing environment variables</h2>
<p>As mentioned I wanted to pass variables from the gocd pipeline server to the apache server. Reason being that any variables defined in the pipeline would create environment variables on the gocd agent. This would then pass them over to the apache server at execution. The script would then execute on the apache server using these values. After a bit of head scratching I came across SendEnv which did this very thing!</p>
<h3 id=sendenv>SendEnv</h3>
<p>SendEnv is one of the many ssh options. The manual defines it as ;</p>
<p><img src=/image//2021/01/image-60.png alt></p>
<p>That makes it so clear!</p>
<p>So to set this up I had to update the sending server (gocd agent) /etc/ssh/ssh_config and the receiving server (apache) /etc/ssh/sshd_config</p>
<p>/etc/ssh/ssh_config</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>SendEnv var1 var2 var3
</code></pre></td></tr></table>
</div>
</div><p>/etc/ssh/sshd_config</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>AcceptEnv var1 var2 var3
</code></pre></td></tr></table>
</div>
</div><p>So any environment variables defined in the pipeline following the names could be passed across</p>
<p><img src=/image//2021/01/image-70.png alt></p>
<p>And then the task configuration</p>
<p><img src=/image//2021/01/image-80.png alt></p>
<p>All environment variables prefixed with DEMO_URL_ will be passed to the ssh target</p>
<h2 id=script>Script</h2>
<p>So lets take a look at the shell script. Similar to my previous scripts we break it down into functions. I will also include remarks to elaborate on some of the code. Not everyone will want or need the remarks so there will be a link at the end to the public GitHub repo.</p>
<h3 id=declarations>Declarations</h3>
<p>This is where we reassign the environment variables sent from the gocd agent using SendEnv. We also perform some concatenation of values which we will use later in the script. Note that my environment was pretty static so I did hardcode a number of the AWS parameters used for Route 53. All of these could be defined as pipeline variables.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=cp>#!/bin/bash
</span><span class=cp></span><span class=c1>#Local declarations based on Env variables passed from gocd agent server</span>
sudo <span class=nv>application</span><span class=o>=</span><span class=si>${</span><span class=nv>DEMO</span><span class=se>\_</span><span class=nv>URL</span><span class=se>\_</span><span class=nv>APPLICATION</span><span class=p>,,</span><span class=si>}</span>
<span class=nv>envcode</span><span class=o>=</span><span class=si>${</span><span class=nv>DEMO</span><span class=se>\_</span><span class=nv>URL</span><span class=se>\_</span><span class=nv>ENVCODE</span><span class=p>,,</span><span class=si>}</span>
<span class=nv>internalhostname</span><span class=o>=</span><span class=si>${</span><span class=nv>DEMO</span><span class=se>\_</span><span class=nv>URL</span><span class=se>\_</span><span class=nv>INTERNALHOSTNAME</span><span class=p>,,</span><span class=si>}</span>
<span class=nv>internalport</span><span class=o>=</span><span class=nv>$DEMO</span><span class=se>\_</span>URL<span class=se>\_</span>INTERNALPORT
<span class=nv>type</span><span class=o>=</span><span class=s2>&#34;https&#34;</span>
<span class=c1>##### Calculated variablees####################</span>
<span class=nv>ProxyPass</span><span class=o>=</span><span class=nv>$type</span><span class=s2>&#34;://&#34;</span><span class=nv>$internalhostname</span><span class=s2>&#34;:&#34;</span><span class=nv>$internalport</span><span class=s2>&#34;/&#34;</span>
<span class=nv>ProxyPassReverse</span><span class=o>=</span><span class=nv>$type</span><span class=s2>&#34;://&#34;</span><span class=nv>$internalhostname</span><span class=s2>&#34;:&#34;</span><span class=nv>$internalport</span><span class=s2>&#34;/&#34;</span>
<span class=c1>#####   start - static variables    #####</span>
supp<span class=se>\_</span>apps<span class=o>=(</span><span class=s2>&#34;first\_app&#34;</span> <span class=s2>&#34;second\_app&#34;</span> <span class=s2>&#34;third\_app&#34;</span><span class=o>)</span> <span class=c1># Used to validate supported rule is being defined</span>
<span class=nv>dt</span><span class=o>=</span><span class=se>\`</span>date +%F<span class=s2>&#34;-&#34;</span>%H<span class=s2>&#34;-&#34;</span>%M<span class=se>\`</span>
<span class=c1># Details for AWS Route53</span>
<span class=nv>ip</span><span class=o>=</span><span class=s2>&#34;0.0.0.0&#34;</span> <span class=c1># External IP used for Route53 to redirect traffic</span>
<span class=nv>type</span><span class=o>=</span><span class=s2>&#34;A&#34;</span>
<span class=nv>ttl</span><span class=o>=</span><span class=m>300</span>
<span class=nv>hostedzoneid</span><span class=o>=</span><span class=s2>&#34;XXXXXXXXXXXXXXXXX&#34;</span> <span class=c1># Your AWS Hosted Zone id</span>
<span class=nv>dnssuffix</span><span class=o>=</span><span class=s2>&#34;.example.com&#34;</span>    <span class=c1>#suffix to add to entry</span>
<span class=nv>comment</span><span class=o>=</span><span class=s2>&#34;Programmatically created DNS Entry for &#34;</span><span class=nv>$record</span><span class=s2>&#34; created on &#34;</span><span class=nv>$dt</span>
<span class=c1>#</span>
<span class=nv>checkpath</span><span class=o>=</span><span class=s2>&#34;/etc/httpd/conf.d/&#34;</span>
<span class=nv>initialrecord</span><span class=o>=</span><span class=nv>$envcode$application</span>

</code></pre></td></tr></table>
</div>
</div><h2 id=functions>Functions</h2>
<h3 id=validate_app>validate_app</h3>
<p>This function ensures the inputs (variables) provided are valid so they process can successfully finish. It first checks if the application type is valid as it relies on this to define which rewrite template to use. Secondly it check to ensure the port is valid as far as it being numeric. You could validate this further by defining an allowed port range. Next it will check if there is an environment code and lastly has an internal hostname be provided. All of these inputs are required to deploy the configuration.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>function validate\_app
{
    echo &#34;Checking if application name &#34;$application&#34; is valid&#34;
    if ( IFS=$&#39;\\n&#39;; echo &#34;${supp\_apps\[\*\]}&#34; ) | grep -qFx &#34;$application&#34;; then
        echo &#34;found application &#34;$application&#34; in approved list, continuing&#34;
    else
        echo &#34;error : &#34;$application&#34; was not found in the list of approved applications&#34;
        echo &#34;Approved applications are : &#34;
        for eachapp in &#34;${supp\_apps\[@\]}&#34;
            do
                echo $eachapp
            done
        echo &#34;error: Please provide an approved application! exiting...&#34;
        exit 1
    fi
	echo &#34;Validating port is a number&#34;
		ncheck=&#39;^\[0-9\]+$&#39;
		if ! \[\[ $internalport =~ $ncheck \]\] ; then
			echo &#34;error : port provided is not a number! exiting...&#34;
			exit 1
		else
			echo &#34;Port is a number, continuing&#34;
		fi
	echo &#34;Checking that an environment has been provided&#34;
		if \[ -z &#34;$envcode&#34; \] ; then
			echo &#34;error: No environment code has been provided! exiting...&#34;
			exit 1
		else
			echo &#34;Environment code has been provided, continuing&#34;
		fi
	echo &#34;Checking that an internal hostname has been provided&#34;
		if \[ -z &#34;$internalhostname&#34; \] ; then
			echo &#34;error: No internal hostname has been provided! exiting...&#34;
			exit 1
		else
			echo &#34;Internal hostname has been provided, continuing&#34;
		fi
}
</code></pre></td></tr></table>
</div>
</div><h3 id=build_record>build_record</h3>
<p>As each environment might have multiple deployments of an application, it was necessary to check what was already configured and then programmatically define the next value. This could have been an environment variable but this method removed possible human error.</p>
<p>It works by concatenating the environment name and application type and then starting at 01 it checks if this exists. If there is already a record it increments by 1 until it cannot find an existing record.</p>
<p>The checks are performed against an array which is populated with all of the record sets deployed in the AWS Route53 hosted zone.</p>
<p>As an example if could build out the name;</p>
<p>z1first_app it would add 01 to the end and check for a record z1first_app01. If this does not already exist the value will be used to build out the FQDN otherwise it will increment by one until it finds a free value. This occurs a max. 20 times.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>function build\_record
{
    #build the A record based on the provided variables calculating the next available address
    found=&#34;&#34;
    rec\_count=0
    existing\_rec\_array=()
    echo &#34;Records to search Route53 : $initialrecord&#34;
    all\_records=(\`aws route53 list-resource-record-sets --hosted-zone-id $hostedzoneid --output text --query &#34;ResourceRecordSets\[\*\].Name&#34;\`)
    echo &#34;Route53 has ${#all\_records\[@\]} registered A Records for $dnssuffix&#34;
    if \[ ${#all\_records\[@\]} -gt 0 \]; then
        #echo &#34;Identifying existing records with similar prefix for processing&#34;
        for record in &#34;${all\_records\[@\]}&#34;
        do
		#echo $record&#34; is being checked!&#34;
            if \[\[ &#34;$record&#34; == \*&#34;$initialrecord&#34;\* \]\]; then
                #echo $record&#34; already exists&#34;
                existing\_rec\_array+=($record)
                found=&#34;yes&#34;
                rec\_count=$(($rec\_count+1))
            fi
        done
    fi
	#echo &#34;Found variable set as &#34;$found
    if \[ &#34;$found&#34; = &#34;&#34; \]; then
        #echo &#34;No records found for $initialrecord&#34;
        record=$initialrecord&#34;01&#34;
        checkurl=$record$dnssuffix
	echo &#34;DNS A Record will be created for &#34;$record
    else
		# There are records following this name, step through and work out available suffix
        available=&#34;&#34;
        available\_count=1
        while \[\[ &#34;$available&#34; != &#34;true&#34; &amp;&amp; &#34;$available\_count&#34; -le 20 \]\];
            do
                printf -v pad\_available\_count &#34;%02d&#34; $available\_count
                #build the string to check for
                checkurl=$initialrecord$pad\_available\_count$dnssuffix
                checkurlprefix=$initialrecord$pad\_available\_count
                checkurldot=$checkurl&#34;.&#34;
                echo &#34;Checking if &#34;$checkurl&#34; is available&#34;
                if ( IFS=$&#39;\\n&#39;; echo &#34;${existing\_rec\_array\[\*\]}&#34; ) | grep -qFx &#34;$checkurldot&#34;; then
                    echo &#34;found existing A record for &#34;$checkurl&#34; , skipping&#34;
                else
                    echo &#34;Did not find any existing A record for &#34;$checkurl
                    echo &#34;We can proceed using &#34;$checkurl&#34; for the new A record&#34;
                    record=$checkurlprefix
                    available=&#34;true&#34;
                fi
                available\_count=$(($available\_count+1))
            done
    fi
}
</code></pre></td></tr></table>
</div>
</div><h3 id=check_conf_d>check_conf_d</h3>
<p>This is a secondary check to ensure there are not any orphaned apache configurations. It is possible a free record could be calculated for Route53 and then an existing configuration file exists. Worth a manual check then.</p>
<p>If an existing conf file is located the pipeline exits.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>function check\_conf\_d
{
    #ensure there are no existing configuration files with this name. Existing suggests an orphaned file as the names should match a route53 rule
    checkfile=$checkpath$checkurlprefix&#34;.conf&#34;
    echo &#34;Checking for existing conf file &#34;$checkfile
    if \[ -f &#34;$checkfile&#34; \]; then
        echo &#34;There is already a config file for this rule. Please advise team to check for orphaned configuration files. Exiting!&#34;
        exit 1
    else
        echo &#34;No existing conf files for &#34;$checkurlprefix&#34; , continuing&#34;
    fi

}
</code></pre></td></tr></table>
</div>
</div><h3 id=update_route53>update_route53</h3>
<p>When using the AWS cli to add a Route53 A record it uses a JSON-formatted configuration file to provide the required configuration. With this requirement the first part of this function created a temporary .json file and populates it with values from either the environment variables or calculated values from previous steps.</p>
<p>Next the function will backup the existing Route53 records and then use the temporary .json file to create the new A-record. Finally the temporary .json file is removed</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>function update\_route53
{
    # First generate a json file with required details as Route53 cli uses this as the input stream
    TMPFILE=$(mktemp testXXX.json)
    echo &#34;Temporary file created : &#34;$TMPFILE
    cat &gt; ${TMPFILE} &lt;&lt; EOF
{
    &#34;Comment&#34;:&#34;$comment&#34;,
    &#34;Changes&#34;:\[
    {
        &#34;Action&#34;:&#34;CREATE&#34;,
        &#34;ResourceRecordSet&#34;:{
        &#34;Name&#34;:&#34;$record$dnssuffix&#34;,
        &#34;Type&#34;:&#34;$type&#34;,
        &#34;TTL&#34;:$ttl,
        &#34;ResourceRecords&#34;:\[{&#34;Value&#34;:&#34;$ip&#34;}\]
        }
    }
    \]
}
EOF

#backup the current record sets first
backfile=&#34;/etc/httpd/route53/backup-&#34;$dt&#34;.json&#34;
echo &#34;creating backup of existing Route53 records : &#34;$backfile
aws route53 list-resource-record-sets --hosted-zone-id $hostedzoneid &gt; $backfile
#use the temporary file to create a record on Route53 using the AWS cli
aws route53 change-resource-record-sets --hosted-zone-id $hostedzoneid --change-batch file://$TMPFILE
#Remove the temporary file
rm -f $TMPFILE
}
</code></pre></td></tr></table>
</div>
</div><h3 id=build_proxy_rule>build_proxy_rule</h3>
<p>This function will build out the .conf file used by the apache server for the rewrite rule. Different rules are defined depending on which application type is being processes. Additional rules can be added in this function if required. The output file is created in the path defined in the checkpath variable (/etc/httpd/conf.d/)</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>function build\_proxy\_rule
{
    echo &#34;creating proxy rule for &#34;$record
    #create a filename
    conf\_file=$checkpath$record&#34;.conf&#34;
    if \[ &#34;$application&#34; == &#34;first\_app&#34; \] ;then
        cat &gt; ${conf\_file} &lt;&lt; EOF
&lt;VirtualHost \*:443&gt;
ServerName $checkurl
SSLEngine on
SSLProxyEngine on
SSLProxyCheckPeerCN off
SSLProxyCheckPeerName off
SSLCertificateFile      &#34;conf/example-wildcard.crt&#34;
SSLCertificateKeyFile   &#34;conf/example-wildcard.key&#34;
SSLProtocol      all -SSLv3 -SSLv2 -TLSv1
SSLCipherSuite ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256
RewriteEngine On
ProxyPass / $ProxyPass
ProxyPassReverse / $ProxyPassReverse
&lt;/VirtualHost&gt;
EOF
    elif \[ &#34;$application&#34; == &#34;second\_app&#34; \] ;then
        cat &gt; ${conf\_file} &lt;&lt; EOF
&lt;VirtualHost \*:443&gt;
ServerName $checkurl
SSLEngine on
SSLProxyEngine on
SSLProxyCheckPeerCN off
SSLProxyCheckPeerName off
SSLCertificateFile      &#34;conf/example-wildcard.crt&#34;
SSLCertificateKeyFile   &#34;conf/example-wildcard.key&#34;
SSLProtocol      all -SSLv3 -SSLv2 -TLSv1
SSLCipherSuite ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256
RewriteEngine On
ProxyPass / $ProxyPass
ProxyPassReverse / $ProxyPassReverse
&lt;/VirtualHost&gt;
EOF
    elif
\[ &#34;$application&#34; == &#34;third\_app&#34; \] ;then
        cat &gt; ${conf\_file} &lt;&lt; EOF
&lt;VirtualHost \*:443&gt;
ServerName      $checkurl
SSLEngine on
SSLProxyEngine on
SSLProxyCheckPeerCN off
SSLProxyCheckPeerName off
SSLCertificateFile      &#34;conf/example-wildcard.crt&#34;
SSLCertificateKeyFile   &#34;conf/example-wildcard.key&#34;
SSLProtocol      all -SSLv3 -SSLv2 -TLSv1
SSLCipherSuite ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256
RewriteEngine On
RewriteCond %{REQUEST\_METHOD} ^(TRACE|TRACK)
RewriteRule .\* - \[F\]
RewriteCond %{HTTP\_HOST} !^$record\\.example\\.com \[NC\]
RewriteRule ^/(.\*)https://$record$dnssuffix/\\$1 \[L,R\]
ProxyPreserveHost on
ProxyPass / $ProxyPass
ProxyPassReverse / $ProxyPassReverse
&lt;/VirtualHost&gt;
EOF
    else
        echo &#34;No proxy build process defined yet for this application. We should never see this message unless the validation has failed!&#34;
    fi
}
</code></pre></td></tr></table>
</div>
</div><h3 id=restart_service>restart_service</h3>
<p>This function will restart the httpd service on the apache server. Apache servers only load their configuration when the service starts.</p>
<p>If you are working in a production environment you would be scheduling this to run out of hours either as a separate task in your pipeline or manually agreed in a downtime window. Mine is development so no issues running at pipeline execution.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>function restart\_service
{
    echo &#34;Restarting the httpd service&#34;
    sudo httpd -k restart
    echo &#34;\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*&#34;
    echo &#34;&#34;
    echo &#34;External URL created : &#34;$checkurl
    echo &#34;&#34;
    echo &#34;\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*&#34;
}
</code></pre></td></tr></table>
</div>
</div><h3 id=main>Main</h3>
<p>Not really a main function as such but just the order of function execution. Located at the bottom of the script.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>validate\_app
build\_record
check\_conf\_d
update\_route53
build\_proxy\_rule
restart\_service
</code></pre></td></tr></table>
</div>
</div><h2 id=conclusion>Conclusion</h2>
<p>So what have we achieved with this process. By defining a handful of variables in a pipelines we can calculate a subdomain name, backup AWS Route53 records, create a new A record, create an apache rewrite rule and restart the apache service.</p>
<p>Mission accomplished!</p>
<p>I enjoyed developing this process as I had to think outside the box for a number of requirements. This also meant I had to do a fair bit of infrastructure reconfiguring before it was viable as the apache server was using a single httpd.conf file.</p>
<p>As usual, here is a <a href=https://github.com/daveihart/bash-aws-apache_rewrite_automation>link</a> to my GitHub repo containing the source code. Feel free to ask any questions or suggest any improvements.</p>
</div>
<footer class=post-footer>
<div class=post-tags>
<a href=https://daveihart.github.io/davehart.co.uk/tags/amazon-linux/>Amazon Linux</a>
<a href=https://daveihart.github.io/davehart.co.uk/tags/apache/>apache</a>
<a href=https://daveihart.github.io/davehart.co.uk/tags/apache/>Apache</a>
<a href=https://daveihart.github.io/davehart.co.uk/tags/aws/>AWS</a>
<a href=https://daveihart.github.io/davehart.co.uk/tags/aws/>AWS</a>
<a href=https://daveihart.github.io/davehart.co.uk/tags/blog/>Blog</a>
<a href=https://daveihart.github.io/davehart.co.uk/tags/cli/>cli</a>
<a href=https://daveihart.github.io/davehart.co.uk/tags/cli/>cli</a>
<a href=https://daveihart.github.io/davehart.co.uk/tags/github/>GitHub</a>
<a href=https://daveihart.github.io/davehart.co.uk/tags/linux/>linux</a>
<a href=https://daveihart.github.io/davehart.co.uk/tags/route53/>route53</a>
<a href=https://daveihart.github.io/davehart.co.uk/tags/shell/>shell</a>
<a href=https://daveihart.github.io/davehart.co.uk/tags/shellscript/>shellscript</a>
</div>
<nav class=post-nav>
<a class=next href=/davehart.co.uk/post/encrypting-ebs-volumes-programmatically-python/>
<span class="next-text nav-default">Encrypting EBS volumes programmatically with python</span>
<span class="prev-text nav-mobile">Next</span>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697c-11.777231-11.500939-30.216186-10.304694-41.178865 2.712784z"/></svg>
</i>
</a>
</nav>
</footer>
</article>
</div>
</div>
</main>
<footer id=footer class=footer>
<div class=icon-links>
<a href=https://twitter.com/daveihart rel="me noopener" class=iconfont title=twitter target=_blank><svg class="icon" viewBox="0 0 1264 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M1229.8616 18.043658s-117.852626 63.135335-164.151872 67.344358C960.484169-78.763856 560.627046-7.210476 627.971403 308.466201 278.622548 312.675223 89.216542 47.506814 89.216542 47.506814S-28.636084 236.91282 164.978944 392.646647C127.097743 396.85567 55.544363 371.601535 55.544363 371.601535S26.081207 535.753407 253.368414 615.724832c-21.045112 29.463156-113.643603 8.418045-113.643603 8.418045s25.254134 143.10676 231.496229 180.987961c-143.10676 130.479693-387.230056 92.598492-370.393967 105.225559 206.242095 189.406006 1119.599946 231.496229 1128.01799-643.98042 50.5082679999998-16.83609 134.688715-143.10676 134.688715-143.10676s-130.479693 37.881201-138.897738 33.672179C1225.652577 98.015083 1229.8616 18.043658 1229.8616 18.043658"/></svg>
</a>
<a href=https://twitter.com/daveihart rel="me noopener" class=iconfont title=linkedin target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="33" height="33"><path d="M872.405333 872.618667H720.768V635.008c0-56.661333-1.152-129.578667-79.018667-129.578667-79.061333.0-91.136 61.653333-91.136 125.397334v241.792H398.976V384H544.64v66.602667h1.962667c20.352-38.4 69.845333-78.933333 143.786666-78.933334 153.642667.0 182.058667 101.12 182.058667 232.746667v268.202667zM227.712 317.141333a87.978667 87.978667.0 01-88.021333-88.106666A88.064 88.064.0 11227.712 317.141333zm76.032 555.477334H151.68V384h152.064v488.618667zM948.266667.0h-872.704C33.792.0.0 33.024.0 73.770667v876.458666C0 991.018667 33.792 1024 75.562667 1024h872.576C989.866667 1024 1024 991.018667 1024 950.229333V73.770667C1024 33.024 989.866667.0 948.138667.0h.128z"/></svg>
</a>
<a href=https://github.com/daveihart rel="me noopener" class=iconfont title=github target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M512 12.672c-282.88.0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667.0-12.16-.426667-44.373333-.64-87.04C242.005334 929.664 211.968 830.08 211.968 830.08 188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333.0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333.0.0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667.0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72.0 68.522667-.64 123.562667-.64 140.202666.0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"/></svg>
</a>
<a href=https://daveihart.github.io/davehart.co.uk/index.xml rel="noopener alternate" type=application/rss+xml class=iconfont title=rss target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30"><path d="M819.157333 1024C819.157333 574.592 449.408 204.8.0 204.8V0c561.706667.0 1024 462.293333 1024 1024H819.157333zM140.416 743.04a140.8 140.8.0 01140.501333 140.586667A140.928 140.928.0 01140.074667 1024C62.72 1024 0 961.109333.0 883.626667S62.933333 743.082667 140.416 743.04zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667v-199.04c372.352.0 678.784 306.517333 678.784 678.826667z"/></svg>
</a>
</div>
<div class=copyright>
<span class=power-by>
Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a>
</span>
<span class=division>|</span>
<span class=theme-info>
Theme - <a class=theme-link href=https://github.com/xianmin/hugo-theme-jane>Jane</a>
</span>
<span class=copyright-year>
&copy;
2020 -
2021
<span class=heart>
<i class=iconfont><svg class="icon" viewBox="0 0 1025 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14"><path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7.0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1.0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2.0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3.1-42.5-8-83.6-24-122.2z" fill="#8a8a8a"/></svg>
</i>
</span><span class=author>
Dave
</span></span>
</div>
</footer>
<div class=back-to-top id=back-to-top>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="35" height="35"><path d="M510.866688 227.694839 95.449397 629.218702h235.761562L329.15309 958.01517h362.40389L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777h894.052392v131.813095H63.840492V63.962777zm0 0"/></svg>
</i>
</div>
</div>
<script type=text/javascript src=/davehart.co.uk/lib/jquery/jquery-3.2.1.min.js></script>
<script type=text/javascript src=/davehart.co.uk/lib/slideout/slideout-1.0.1.min.js></script>
<script type=text/javascript src=/davehart.co.uk/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin=anonymous></script>
<script type=text/javascript src=/davehart.co.uk/js/load-photoswipe.js></script>
<script type=text/javascript src=/davehart.co.uk/lib/photoswipe/photoswipe.min.js></script>
<script type=text/javascript src=/davehart.co.uk/lib/photoswipe/photoswipe-ui-default.min.js></script>
</body>
</html>