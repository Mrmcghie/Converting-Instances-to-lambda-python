<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title>Terraform: Multi-cloud demo – Part 4 – AWS Instances - Dave's DevOps blog</title>
<meta name=renderer content="webkit">
<meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes">
<meta name=MobileOptimized content="width">
<meta name=HandheldFriendly content="true">
<meta name=applicable-device content="pc,mobile">
<meta name=theme-color content="#f8f5ec">
<meta name=msapplication-navbutton-color content="#f8f5ec">
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec">
<meta name=mobile-web-app-capable content="yes">
<meta name=author content="Dave">
<meta name=description content="Now we have our security groups and instance profile, lets look at creating our ec2 instances. We will be defining our own module which fits our requirements and introducing userdata and templatefile functions.
First we will setup and configure our modules main.tf (modules/instances/main.tf)
Module : instances 1 2 3 4 5 6 7 8 9 10 11 12 13 14  terraform { required_version =&amp;#34;&amp;gt;=0.14.8&amp;#34; } resource &amp;#34;aws_instance&amp;#34; &amp;#34;instance&amp;#34; {# aws_instance resource type ami = var.">
<meta name=keywords content="Hugo,theme,jane">
<meta name=generator content="Hugo 0.88.1">
<link rel=canonical href=https://davehart.co.uk/post/terraform-multi-cloud-demo-part-4-aws-instances/>
<link rel=icon href=/favicon.ico>
<link rel=stylesheet href=/sass/jane.min.fa4b2b9f31b5c6d0b683db81157a9226e17b06e61911791ab547242a4a0556f2.css integrity="sha256-+ksrnzG1xtC2g9uBFXqSJuF7BuYZEXkatUckKkoFVvI=" media=screen crossorigin=anonymous>
<meta property="og:title" content="Terraform: Multi-cloud demo – Part 4 – AWS Instances">
<meta property="og:description" content="Now we have our security groups and instance profile, lets look at creating our ec2 instances. We will be defining our own module which fits our requirements and introducing userdata and templatefile functions.
First we will setup and configure our modules main.tf (modules/instances/main.tf)
Module : instances 1 2 3 4 5 6 7 8 9 10 11 12 13 14  terraform { required_version =&#34;>=0.14.8&#34; } resource &#34;aws_instance&#34; &#34;instance&#34; {# aws_instance resource type ami = var.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://davehart.co.uk/post/terraform-multi-cloud-demo-part-4-aws-instances/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2021-04-09T14:49:11+00:00">
<meta property="article:modified_time" content="2021-04-09T14:49:11+00:00">
<meta itemprop=name content="Terraform: Multi-cloud demo – Part 4 – AWS Instances">
<meta itemprop=description content="Now we have our security groups and instance profile, lets look at creating our ec2 instances. We will be defining our own module which fits our requirements and introducing userdata and templatefile functions.
First we will setup and configure our modules main.tf (modules/instances/main.tf)
Module : instances 1 2 3 4 5 6 7 8 9 10 11 12 13 14  terraform { required_version =&#34;>=0.14.8&#34; } resource &#34;aws_instance&#34; &#34;instance&#34; {# aws_instance resource type ami = var."><meta itemprop=datePublished content="2021-04-09T14:49:11+00:00">
<meta itemprop=dateModified content="2021-04-09T14:49:11+00:00">
<meta itemprop=wordCount content="1654">
<meta itemprop=keywords content="AWS,AWS,Blog,demo,GitHub,Remote State,remote-state,Terraform,Terraform,"><meta name=twitter:card content="summary">
<meta name=twitter:title content="Terraform: Multi-cloud demo – Part 4 – AWS Instances">
<meta name=twitter:description content="Now we have our security groups and instance profile, lets look at creating our ec2 instances. We will be defining our own module which fits our requirements and introducing userdata and templatefile functions.
First we will setup and configure our modules main.tf (modules/instances/main.tf)
Module : instances 1 2 3 4 5 6 7 8 9 10 11 12 13 14  terraform { required_version =&#34;>=0.14.8&#34; } resource &#34;aws_instance&#34; &#34;instance&#34; {# aws_instance resource type ami = var."><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]-->
</head>
<body>
<div id=mobile-navbar class=mobile-navbar>
<div class=mobile-header-logo>
<a href=/ class=logo>Dave's blog</a>
</div>
<div class=mobile-navbar-icon>
<span></span>
<span></span>
<span></span>
</div>
</div>
<nav id=mobile-menu class="mobile-menu slideout-menu">
<ul class=mobile-menu-list>
<li class=mobile-menu-item>
<a class=menu-item-link href=https://davehart.co.uk/>Home</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://davehart.co.uk/post/>Posts</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://davehart.co.uk/tags/>Tags</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://davehart.co.uk/privacy/>Privacy Policy</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://davehart.co.uk/about/>About</a>
</li>
</ul>
</nav>
<link rel=stylesheet href=/lib/photoswipe/photoswipe.min.css>
<link rel=stylesheet href=/lib/photoswipe/default-skin/default-skin.min.css>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div>
<header id=header class="header container">
<div class=logo-wrapper>
<a href=/ class=logo>
Dave's blog
</a>
</div>
<nav class=site-navbar>
<ul id=menu class=menu>
<li class=menu-item>
<a class=menu-item-link href=https://davehart.co.uk/>Home</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://davehart.co.uk/post/>Posts</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://davehart.co.uk/tags/>Tags</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://davehart.co.uk/privacy/>Privacy Policy</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://davehart.co.uk/about/>About</a>
</li>
</ul>
</nav>
</header>
<div id=mobile-panel>
<main id=main class="main bg-llight">
<div class=content-wrapper>
<div id=content class="content container">
<article class="post bg-white">
<header class=post-header>
<h1 class=post-title>Terraform: Multi-cloud demo – Part 4 – AWS Instances</h1>
<div class=post-meta>
<time datetime=2021-04-09 class=post-time>
2021-04-09
</time>
<span class=more-meta> 1654 words </span>
<span class=more-meta> 8 min read </span>
</div>
</header>
<div class=post-toc id=post-toc>
<h2 class=post-toc-title>Table of Contents</h2>
<div class=post-toc-content>
<nav id=TableOfContents>
<ul>
<li><a href=#module--instances>Module : instances</a>
<ul>
<li><a href=#terraform-init>Terraform init</a></li>
</ul>
</li>
<li><a href=#source-control>Source control</a></li>
<li><a href=#summary>Summary</a></li>
</ul>
</nav>
</div>
</div>
<div class=post-content>
<p>Now we have our security groups and instance profile, lets look at creating our ec2 instances. We will be defining our own module which fits our requirements and introducing userdata and templatefile functions.</p>
<p>First we will setup and configure our modules main.tf (modules/instances/main.tf)</p>
<h2 id=module--instances>Module : instances</h2>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-HCL data-lang=HCL><span class=k>terraform</span> {
<span class=n>    required_version</span> <span class=o>=</span><span class=n> &#34;&gt;</span><span class=o>=</span><span class=m>0</span><span class=p>.</span><span class=m>14</span><span class=p>.</span><span class=m>8</span><span class=err>&#34;</span>
}

<span class=k>resource</span> <span class=s2>&#34;aws_instance&#34; &#34;instance&#34;</span> {<span class=c1>                                    # aws_instance resource type
</span><span class=c1></span><span class=n>    ami</span>                    <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>ami</span><span class=c1>                                    # the ami id
</span><span class=c1></span><span class=n>    iam_instance_profile</span>   <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>iam_inst_prof</span><span class=c1>                          # the instance profile/role to attach
</span><span class=c1></span><span class=n>    instance_type</span>          <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>ec2_instance_size</span><span class=c1>                      # the instance size
</span><span class=c1></span><span class=n>    subnet_id</span>              <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>ec2_subnet</span><span class=c1>                             # which subnet to deploy into
</span><span class=c1></span><span class=n>    vpc_security_group_ids</span> <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>vpc_sg_ids</span><span class=c1>                             # security groups
</span><span class=c1></span><span class=n>    key_name</span>               <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>key_name</span><span class=c1>                               # ssh key
</span><span class=c1></span><span class=n>    tags</span>                   <span class=o>=</span><span class=n> merge(var.ec2_tags,{Name</span> <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>ec2_name</span>}<span class=p>)</span><span class=c1>  # tags
</span><span class=c1></span><span class=n>    user_data</span>              <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>userdata</span><span class=c1>                               # userdata to apply
</span><span class=c1></span>}
</code></pre></td></tr></table>
</div>
</div><p>Looks fairly simple. Lets declare our variables for the module;</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-HCL data-lang=HCL><span class=k>variable</span> <span class=s2>&#34;ec2_instance_size&#34;</span> {
<span class=n>    type</span> <span class=o>=</span> <span class=k>string</span>
<span class=n>    default</span> <span class=o>=</span> <span class=s2>&#34;t2.micro&#34;</span>
}
<span class=k>variable</span> <span class=s2>&#34;key_name&#34;</span> {
<span class=n>    type</span> <span class=o>=</span> <span class=k>string</span>
}
<span class=k>variable</span> <span class=s2>&#34;ec2_name&#34;</span> {
<span class=n>    type</span> <span class=o>=</span> <span class=k>string</span>
}
<span class=k>variable</span> <span class=s2>&#34;ec2_tags&#34;</span> {
<span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;resource tags&#34;</span>
<span class=n>  type</span>        <span class=o>=</span> <span class=k>map</span><span class=p>(</span><span class=k>any</span><span class=p>)</span>
<span class=n>  default</span> <span class=o>=</span>   {}
}
<span class=k>variable</span> <span class=s2>&#34;iam_inst_prof&#34;</span> {
<span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;IAM Instance profile name&#34;</span>
<span class=n>  type</span>        <span class=o>=</span> <span class=k>string</span>
<span class=n>  default</span>     <span class=o>=</span> <span class=s2>&#34;&#34;</span>
}
<span class=k>variable</span> <span class=s2>&#34;userdata&#34;</span> {
<span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;user_data template by type&#34;</span>
<span class=n>  type</span>        <span class=o>=</span> <span class=k>string</span>
<span class=n>  default</span>     <span class=o>=</span> <span class=s2>&#34;&#34;</span>
}
<span class=k>variable</span> <span class=s2>&#34;ec2_subnet&#34;</span> {
<span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;user_data template by type&#34;</span>
<span class=n>  type</span>        <span class=o>=</span> <span class=k>string</span>
<span class=n>  default</span>     <span class=o>=</span> <span class=s2>&#34;&#34;</span>
}
<span class=k>variable</span> <span class=s2>&#34;vpc_sg_ids&#34;</span> {
<span class=n>    description</span> <span class=o>=</span> <span class=s2>&#34;list of security groups&#34;</span>
<span class=n>    type</span> <span class=o>=</span> <span class=k>list</span>
<span class=n>    default</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;&#34;</span><span class=p>]</span>
}
<span class=k>variable</span> <span class=s2>&#34;ami&#34;</span> {
<span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;AWS ami to use for instance&#34;</span>
<span class=n>  type</span>        <span class=o>=</span> <span class=k>string</span>
<span class=n>  default</span>     <span class=o>=</span> <span class=s2>&#34;&#34;</span>
}
</code></pre></td></tr></table>
</div>
</div><p>We will add some outputs in this module to make it easier to connect and test afterwards.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-HCL data-lang=HCL><span class=k>output</span> <span class=s2>&#34;public_ip&#34;</span> {
<span class=n>  value</span> <span class=o>=</span> <span class=k>join</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=k>aws_instance</span><span class=p>.</span><span class=k>instance</span><span class=p>[</span><span class=err>*</span><span class=p>].</span><span class=k>public_ip</span><span class=p>)</span>
}

<span class=k>output</span> <span class=s2>&#34;private_ip&#34;</span> {
<span class=n>    value</span> <span class=o>=</span> <span class=k>join</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=k>aws_instance</span><span class=p>.</span><span class=k>instance</span><span class=p>[</span><span class=err>*</span><span class=p>].</span><span class=k>private_ip</span><span class=p>)</span>
}
</code></pre></td></tr></table>
</div>
</div>
<figure style="padding:.25rem;margin:2rem 0;background-color:#fff">
<img style=max-width:100%;width:auto;height:auto src=/post/terraform-multi-cloud-demo-part-4-aws-instances/info_hu90bf0207219454fdfafbb9c93dc105ef_65820_100x0_resize_q75_box.jpg width=100 height=100>
</figure>
<p><em>**The use of the join function allows us to concatenate a number of elements. By joining an empty string "" with the instance values we can prevent the code from failing should there be no value to output. It will then just output an empty string. For example, any instances deployed in the private subnets would not have a public_ip to output so would result in a failure when applied.</em>**</p>
<p>Now we have our instances module setup, lets call it to deploy first the proxy (NGINX) server</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-HCL data-lang=HCL><span class=k>module</span> <span class=s2>&#34;proxy_server&#34;</span> {
<span class=n>  source</span>            <span class=o>=</span> <span class=s2>&#34;./modules/instances&#34;</span>
<span class=n>  count</span>             <span class=o>=</span> <span class=m>1</span>
<span class=n>  ec2_name</span>          <span class=o>=</span> <span class=s2>&#34;${&#34;core-proxy&#34;}${format(&#34;%02d&#34;,count.index+1)}&#34;</span>
<span class=n>  key_name</span>          <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>key_name</span><span class=c1>                                     # we will need to define this in our root variables.tf
</span><span class=c1></span><span class=n>  ec2_subnet</span>        <span class=o>=</span> <span class=k>module</span><span class=p>.</span><span class=k>vpc</span><span class=p>.</span><span class=k>public_subnets</span><span class=p>[</span><span class=m>0</span><span class=p>]</span><span class=c1>                     # retrieve the public sn from the vpc module
</span><span class=c1></span><span class=n>  vpc_sg_ids</span>        <span class=o>=</span> <span class=p>[</span><span class=k>module</span><span class=p>.</span><span class=k>security</span><span class=err>-</span><span class=k>group</span><span class=err>-</span><span class=k>prometheus</span><span class=p>.</span><span class=k>this_security_group_id</span><span class=p>,</span> <span class=k>module</span><span class=p>.</span><span class=k>security</span><span class=err>-</span><span class=k>group</span><span class=err>-</span><span class=k>proxy</span><span class=p>.</span><span class=k>this_security_group_id</span><span class=p>]</span><span class=c1>                                          # retrieve the security group id from the module
</span><span class=c1></span><span class=n>  ami</span>               <span class=o>=</span> <span class=k>data</span><span class=p>.</span><span class=k>aws_ami</span><span class=p>.</span><span class=k>aws</span><span class=err>-</span><span class=k>linux2</span><span class=p>.</span><span class=k>id</span><span class=c1>                       # we will need a data source to get the latest ami
</span><span class=c1></span><span class=n>  iam_inst_prof</span>     <span class=o>=</span> <span class=k>module</span><span class=p>.</span><span class=k>instance_profile</span><span class=p>.</span><span class=k>iam_instance_profile_name</span><span class=c1># profile name from our module
</span><span class=c1></span><span class=n>  ec2_instance_size</span> <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>instance_size</span><span class=p>[</span><span class=s2>&#34;proxy&#34;</span><span class=p>]</span><span class=c1>                       # instance size map variable. Need to define 
</span><span class=c1></span><span class=n>  ec2_tags</span>          <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>tags</span>
<span class=n>  userdata</span>          <span class=o>=</span><span class=n> templatefile(&#34;./templates/proxy.tpl&#34;,{proxy_server</span> <span class=o>=</span><span class=n> (&#34;core-proxy${format(&#34;%02d&#34;,count.index+1)}&#34;), prom_server</span> <span class=o>=</span> <span class=k>module</span><span class=p>.</span><span class=k>prometheus_server</span><span class=p>[</span><span class=k>count</span><span class=p>.</span><span class=k>index</span><span class=p>].</span><span class=k>private_ip</span>}<span class=p>)</span>
}

</code></pre></td></tr></table>
</div>
</div><p>Looks a bit more complicated this time around. Recent changes to Terraform allowed the count to be used when calling a module which makes it easier for us to define reusable code. It is now similar to how you would execute a count within a resource.</p>
<p>Lets drill into some of the lines of code (I have added comments to the ones which are pretty self explanatory);</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-HCL data-lang=HCL><span class=n>count</span>             <span class=o>=</span> <span class=m>1</span>
</code></pre></td></tr></table>
</div>
</div><p>when you deploy a resource it will by default only configure one object. By adding the count meta-argument you can deploy multiple similar configurations. An alternative to using count would be for_each but this requires the for_each values are known before terraform performs any remote resource actions. As I am using the output of one instance module to set a value on another instance module (in the userdata) I am creating two modules but will be consuming the same source files.</p>
<p>One module could be used with for_each but I would have to use another mechanism to configure the proxy server. Count is not necessary in this deployment but it is useful to show different ways you can utilise the count.index.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-HCL data-lang=HCL><span class=n>ec2_name</span>          <span class=o>=</span> <span class=s2>&#34;${&#34;core-proxy&#34;}${format(&#34;%02d&#34;,count.index+1)}&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>The ec2_name value is appending the first interpolation of the servername with the count index (+1 as it starts at 0) and ensuring it is 2 decimal places. If we had a count of 2 we would end up with;</p>
<p>core-proxy01 , core-proxy02 and core-proxy03 as we iterate through the count</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-HCL data-lang=HCL><span class=n>ec2_instance_size</span> <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>instance_size</span><span class=p>[</span><span class=s2>&#34;proxy&#34;</span><span class=p>]</span>
</code></pre></td></tr></table>
</div>
</div><p>The ec2_instance_size is referencing a variable which will be of type map. Depending what key is called (In this case it is &ldquo;proxy&rdquo;) the value associated with the key will be returned. Lets add the variable to our root module variables.tf. I am using t2.micro for both instances to reduce cost but I am sure you get the idea :)</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-HCL data-lang=HCL><span class=k>variable</span> <span class=s2>&#34;instance_size&#34;</span> {
<span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;instance type mapped to role&#34;</span>
<span class=n>  type</span>        <span class=o>=</span> <span class=k>map</span><span class=p>(</span><span class=k>any</span><span class=p>)</span>
<span class=n>  default</span> <span class=o>=</span> {
<span class=n>    prometheus</span> <span class=o>=</span> <span class=s2>&#34;t2.micro&#34;</span>
<span class=n>    proxy</span>      <span class=o>=</span> <span class=s2>&#34;t2.micro&#34;</span>
  }
}
</code></pre></td></tr></table>
</div>
</div><p>Next we will define which ami to use for our instances. I am looking to use the latest amazon linux2 ami</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-HCL data-lang=HCL><span class=n>ami</span>               <span class=o>=</span> <span class=k>data</span><span class=p>.</span><span class=k>aws_ami</span><span class=p>.</span><span class=k>aws</span><span class=err>-</span><span class=k>linux2</span><span class=p>.</span><span class=k>id</span> 
</code></pre></td></tr></table>
</div>
</div><p>This line is referring to a data source names aws_ami which we have not yet defined. Lets define this in our root module main.tf adding some comments inline.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-HCL data-lang=HCL><span class=k>data</span> <span class=s2>&#34;aws_ami&#34; &#34;aws-linux2&#34;</span> {
<span class=n>  most_recent</span> <span class=o>=</span> <span class=kt>true</span><span class=c1>                                            # Retrieve the latest ami
</span><span class=c1></span><span class=n>  owners</span>      <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;amazon&#34;</span><span class=p>]</span><span class=c1>                                      # It must be owned by amazon
</span><span class=c1></span>  <span class=k>filter</span> {<span class=c1>                                                      # add some filters
</span><span class=c1></span><span class=n>    name</span>   <span class=o>=</span> <span class=s2>&#34;name&#34;</span>                                     
    <span class=n>values</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;amzn2-ami-hvm*&#34;</span><span class=p>]</span><span class=c1>                                 # The name must begin with amzn2-ami-hvm
</span><span class=c1></span>  }
  <span class=k>filter</span> {
<span class=n>    name</span>   <span class=o>=</span> <span class=s2>&#34;root-device-type&#34;</span>
<span class=n>    values</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;ebs&#34;</span><span class=p>]</span><span class=c1>                                            # The root volume must be of type ebs
</span><span class=c1></span>  }
}
</code></pre></td></tr></table>
</div>
</div><p>Lastly, lets take a look at how we are providing the userdata using a templatefile.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-HCL data-lang=HCL><span class=n>userdata</span>          <span class=o>=</span><span class=n> templatefile(&#34;./templates/proxy.tpl&#34;,{proxy_server</span> <span class=o>=</span><span class=n> (&#34;core-proxy${format(&#34;%02d&#34;,count.index+1)}&#34;), prom_server</span> <span class=o>=</span> <span class=k>module</span><span class=p>.</span><span class=k>prometheus_server</span><span class=p>[</span><span class=k>count</span><span class=p>.</span><span class=k>index</span><span class=p>].</span><span class=k>private_ip</span>}<span class=p>)</span>
}
</code></pre></td></tr></table>
</div>
</div>
<figure style="padding:.25rem;margin:2rem 0;background-color:#fff">
<img style=max-width:100%;width:auto;height:auto src=/post/terraform-multi-cloud-demo-part-4-aws-instances/info_hu90bf0207219454fdfafbb9c93dc105ef_65820_100x0_resize_q75_box.jpg width=100 height=100>
</figure>
<p><em>**The <a href=https://www.terraform.io/docs/language/functions/templatefile.html>templatefile</a> reads the file at the given path and renders its content as a template using a supplied set of template variables.</em>**</p>
<p>We have mentioned a template file in the templates folder named proxy.tpl. In our example this is a shell script which will be looking for a proxy_server and prom_server variable for it to execute. You can see that this script is now relying on the completion of a prometheus_server module which we will define shortly.</p>
<p>Below is a snippet of the code deployed in the templates/proxy.tpl (The complete file will be in the git repository)</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=cp>#!/bin/sh
</span><span class=cp></span><span class=nv>server_name</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>proxy_server</span><span class=si>}</span><span class=s2>&#34;</span>                               <span class=c1># This is the proxy_server variable we are passing in</span>
sudo hostnamectl set-hostname <span class=nv>$server_name</span> --static
sudo yum update -y
sudo amazon-linux-extras install nginx1 -y
sudo rm -f /etc/nginx/nginx.conf
sudo cat &gt; /etc/nginx/nginx.conf <span class=s>&lt;&lt;EOF
</span><span class=s>user nginx;
</span><span class=s>worker_processes auto;
</span><span class=s>error_log /var/log/nginx/error.log;
</span><span class=s>pid /run/nginx.pid;
</span><span class=s>include /usr/share/nginx/modules/*.conf;
</span><span class=s>events {
</span><span class=s>    worker_connections 1024;
</span><span class=s>}
</span><span class=s>http {
</span><span class=s>    server {
</span><span class=s>        listen       80;
</span><span class=s>        listen       [::]:80;
</span><span class=s>        server_name  _;
</span><span class=s>        location /prometheus/ {
</span><span class=s>        proxy_pass http://${prom_server}:9090;            # Here is the prom_server variable we are passing in
</span><span class=s>        }
</span><span class=s>        # Load configuration files for the default server block.
</span><span class=s>        include /etc/nginx/default.d/*.conf;
</span><span class=s>        error_page 404 /404.html;
</span><span class=s>            location = /40x.html {
</span><span class=s>        }
</span><span class=s>
</span><span class=s>        error_page 500 502 503 504 /50x.html;
</span><span class=s>            location = /50x.html {
</span><span class=s>        }
</span><span class=s>    }
</span><span class=s>}
</span><span class=s>EOF</span>
.....
</code></pre></td></tr></table>
</div>
</div><p>We will now add the Prometheus servers module to the root module main.tf using the same source.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-HCL data-lang=HCL><span class=k>module</span> <span class=s2>&#34;prometheus_server&#34;</span> {
<span class=n>  source</span>            <span class=o>=</span> <span class=s2>&#34;./modules/instances&#34;</span>
<span class=n>  count</span>             <span class=o>=</span> <span class=m>1</span>
<span class=n>  ec2_name</span>          <span class=o>=</span> <span class=s2>&#34;${&#34;core-prom&#34;}${format(&#34;%02d&#34;,count.index+1)}&#34;</span>
<span class=n>  key_name</span>          <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>key_name</span>
<span class=n>  ec2_subnet</span>        <span class=o>=</span> <span class=k>module</span><span class=p>.</span><span class=k>vpc</span><span class=p>.</span><span class=k>private_subnets</span><span class=p>[</span><span class=m>0</span><span class=p>]</span>
<span class=n>  vpc_sg_ids</span>        <span class=o>=</span> <span class=p>[</span><span class=k>module</span><span class=p>.</span><span class=k>security</span><span class=err>-</span><span class=k>group</span><span class=err>-</span><span class=k>prometheus</span><span class=p>.</span><span class=k>this_security_group_id</span><span class=p>,</span> <span class=k>module</span><span class=p>.</span><span class=k>security</span><span class=err>-</span><span class=k>group</span><span class=err>-</span><span class=k>proxy</span><span class=p>.</span><span class=k>this_security_group_id</span><span class=p>]</span>
<span class=n>  ami</span>               <span class=o>=</span> <span class=k>data</span><span class=p>.</span><span class=k>aws_ami</span><span class=p>.</span><span class=k>aws</span><span class=err>-</span><span class=k>linux2</span><span class=p>.</span><span class=k>id</span>
<span class=n>  iam_inst_prof</span>     <span class=o>=</span> <span class=k>module</span><span class=p>.</span><span class=k>instance_profile</span><span class=p>.</span><span class=k>iam_instance_profile_name</span>
<span class=n>  ec2_instance_size</span> <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>instance_size</span><span class=p>[</span><span class=s2>&#34;prometheus&#34;</span><span class=p>]</span>
<span class=n>  ec2_tags</span>          <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>tags</span>
<span class=n>  userdata</span>          <span class=o>=</span><span class=n> templatefile(&#34;./templates/prometheus.tpl&#34;, {prometheus_server</span> <span class=o>=</span> <span class=p>(</span><span class=s2>&#34;core-prom${format(&#34;%02d&#34;,count.index+1)}&#34;</span><span class=p>)</span>}<span class=p>)</span>
}
</code></pre></td></tr></table>
</div>
</div><p>Snippet of the prometheus.tpl shell script which is only expecting the variable prometheus_server;</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=cp>#!/bin/bash
</span><span class=cp></span><span class=c1>#Update and Install</span>
<span class=nv>servername</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>prometheus_server</span><span class=si>}</span><span class=s2>&#34;</span>                       <span class=c1># Here is the prometheus_server variable we are passing in</span>
sudo <span class=nb>echo</span> <span class=s2>&#34;127.0.0.1   &#34;</span><span class=nv>$servername</span> &gt;&gt; /etc/hosts
sudo hostnamectl set-hostname <span class=nv>$servername</span> --static
sudo yum update -y
sudo yum install wget -y
sudo useradd --no-create-home svc-prom
sudo mkdir /etc/prometheus
sudo mkdir /var/lib/prometheus
wget https://github.com/prometheus/prometheus/releases/download/v2.19.0/prometheus-2.19.0.linux-amd64.tar.gz
tar xvfz prometheus-2.19.0.linux-amd64.tar.gz
....

</code></pre></td></tr></table>
</div>
</div><p>That should be all the code we need to write. Lets try it out!</p>
<h3 id=terraform-init>Terraform init</h3>
<p>We will first initialise our Terraform configuration so Terraform can prepare our working directory for its use.</p>
<p><img src=demo4-terraform-init.gif alt></p>
<p>Terraform output for the init phase</p>
<p>All good, lets run the plan</p>
<p><img src=demo4-terraform-plan.gif alt></p>
<p>Terraform output for the plan phase</p>
<p>No errors and a quick look through the plan shows the expected resources being deployed. Lets apply our demo plan!</p>
<p><img src=demo4-terraform-apply.gif alt></p>
<p>terraform apply demo.tfplan</p>
<p>Lets take a look in our aws console and see what we have.</p>
<p><img src=demo4-aws-console-network.gif alt></p>
<h2 id=source-control>Source control</h2>
<p>All of the code used in this demo is available in my <a href=https://github.com/daveihart/tf-training-demo1>git repository</a></p>
<h2 id=summary>Summary</h2>
<p>That ends the demonstration. Through the 4 parts we have setup our source control, deployed azure infrastructure to host our Terraform remote state file using terraform and lastly we have deployed numerous AWS infrastructure components including a NGINX proxy server and Prometheus server configured completely using the userdata (bootstrap).</p>
<p>If you followed along and with to tear down your infrastructure it should be pretty simple.</p>
<ol>
<li>Move you state back to local by changing the root module backend back to local and then run terraform init</li>
</ol>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-HCL data-lang=HCL><span class=k>terraform</span> {
    <span class=k>backend</span> <span class=s2>&#34;local&#34;</span> {
    }
}
</code></pre></td></tr></table>
</div>
</div>
<figure>
<img sizes="(min-width: 35em) 1200px, 100vw" srcset="https://davehart.co.uk/post/terraform-multi-cloud-demo-part-4-aws-instances/image-2_hu4bcc9b17e20b2176cab300e1bdfc43d4_85002_480x0_resize_box_3.png 480w,
https://davehart.co.uk/post/terraform-multi-cloud-demo-part-4-aws-instances/image-2_hu4bcc9b17e20b2176cab300e1bdfc43d4_85002_800x0_resize_box_3.png 800w," src=https://davehart.co.uk/post/terraform-multi-cloud-demo-part-4-aws-instances/image-2_hu4bcc9b17e20b2176cab300e1bdfc43d4_85002_800x0_resize_box_3.png>
</figure>
<p>Moving state back to local with terraform init</p>
<ol start=2>
<li>Once the state is back local, run a terraform destroy</li>
</ol>
<figure>
<img sizes="(min-width: 35em) 1200px, 100vw" srcset="https://davehart.co.uk/post/terraform-multi-cloud-demo-part-4-aws-instances/image-3_hub0d0f21de807f8703150ba6900c08fec_18512_480x0_resize_box_3.png 480w,
https://davehart.co.uk/post/terraform-multi-cloud-demo-part-4-aws-instances/image-3_hub0d0f21de807f8703150ba6900c08fec_18512_800x0_resize_box_3.png 800w," src=https://davehart.co.uk/post/terraform-multi-cloud-demo-part-4-aws-instances/image-3_hub0d0f21de807f8703150ba6900c08fec_18512_800x0_resize_box_3.png>
</figure>
<p>Output from terraform destroy</p>
<figure>
<img sizes="(min-width: 35em) 1200px, 100vw" srcset="https://davehart.co.uk/post/terraform-multi-cloud-demo-part-4-aws-instances/image-4_hu7cd86ee6089694c21ac6bf07da655cda_3823_480x0_resize_box_3.png 480w," src=https://davehart.co.uk/post/terraform-multi-cloud-demo-part-4-aws-instances/image-4.png>
</figure>
<p>Feel free to comment or contact me with any queries. Happy terraforming</p>
<p>Disclaimer: You may incur costs if you follow along with the exercise. Use at your own risk!</p>
</div>
<footer class=post-footer>
<div class=post-tags>
<a href=https://davehart.co.uk/tags/aws/>AWS</a>
<a href=https://davehart.co.uk/tags/aws/>AWS</a>
<a href=https://davehart.co.uk/tags/blog/>Blog</a>
<a href=https://davehart.co.uk/tags/demo/>demo</a>
<a href=https://davehart.co.uk/tags/github/>GitHub</a>
<a href=https://davehart.co.uk/tags/remote-state/>Remote State</a>
<a href=https://davehart.co.uk/tags/remote-state/>remote-state</a>
<a href=https://davehart.co.uk/tags/terraform/>Terraform</a>
<a href=https://davehart.co.uk/tags/terraform/>Terraform</a>
</div>
<nav class=post-nav>
<a class=next href=/post/terraform-multi-cloud-demo-part-3-aws-infrastructure/>
<span class="next-text nav-default">Terraform: Multi-cloud demo – Part 3 – AWS Infrastructure</span>
<span class="prev-text nav-mobile">Next</span>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697c-11.777231-11.500939-30.216186-10.304694-41.178865 2.712784z"/></svg>
</i>
</a>
</nav>
</footer>
</article>
</div>
</div>
</main>
<footer id=footer class=footer>
<div class=icon-links>
<a href=https://twitter.com/daveihart rel="me noopener" class=iconfont title=twitter target=_blank><svg class="icon" viewBox="0 0 1264 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M1229.8616 18.043658s-117.852626 63.135335-164.151872 67.344358C960.484169-78.763856 560.627046-7.210476 627.971403 308.466201 278.622548 312.675223 89.216542 47.506814 89.216542 47.506814S-28.636084 236.91282 164.978944 392.646647C127.097743 396.85567 55.544363 371.601535 55.544363 371.601535S26.081207 535.753407 253.368414 615.724832c-21.045112 29.463156-113.643603 8.418045-113.643603 8.418045s25.254134 143.10676 231.496229 180.987961c-143.10676 130.479693-387.230056 92.598492-370.393967 105.225559 206.242095 189.406006 1119.599946 231.496229 1128.01799-643.98042 50.5082679999998-16.83609 134.688715-143.10676 134.688715-143.10676s-130.479693 37.881201-138.897738 33.672179C1225.652577 98.015083 1229.8616 18.043658 1229.8616 18.043658"/></svg>
</a>
<a href=https://www.linkedin.com/in/dave-hart/ rel="me noopener" class=iconfont title=linkedin target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="33" height="33"><path d="M872.405333 872.618667H720.768V635.008c0-56.661333-1.152-129.578667-79.018667-129.578667-79.061333.0-91.136 61.653333-91.136 125.397334v241.792H398.976V384H544.64v66.602667h1.962667c20.352-38.4 69.845333-78.933333 143.786666-78.933334 153.642667.0 182.058667 101.12 182.058667 232.746667v268.202667zM227.712 317.141333a87.978667 87.978667.0 01-88.021333-88.106666A88.064 88.064.0 11227.712 317.141333zm76.032 555.477334H151.68V384h152.064v488.618667zM948.266667.0h-872.704C33.792.0.0 33.024.0 73.770667v876.458666C0 991.018667 33.792 1024 75.562667 1024h872.576C989.866667 1024 1024 991.018667 1024 950.229333V73.770667C1024 33.024 989.866667.0 948.138667.0h.128z"/></svg>
</a>
<a href=https://github.com/daveihart rel="me noopener" class=iconfont title=github target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M512 12.672c-282.88.0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667.0-12.16-.426667-44.373333-.64-87.04C242.005334 929.664 211.968 830.08 211.968 830.08 188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333.0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333.0.0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667.0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72.0 68.522667-.64 123.562667-.64 140.202666.0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"/></svg>
</a>
<a href=https://davehart.co.uk/index.xml rel="noopener alternate" type=application/rss+xml class=iconfont title=rss target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30"><path d="M819.157333 1024C819.157333 574.592 449.408 204.8.0 204.8V0c561.706667.0 1024 462.293333 1024 1024H819.157333zM140.416 743.04a140.8 140.8.0 01140.501333 140.586667A140.928 140.928.0 01140.074667 1024C62.72 1024 0 961.109333.0 883.626667S62.933333 743.082667 140.416 743.04zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667v-199.04c372.352.0 678.784 306.517333 678.784 678.826667z"/></svg>
</a>
</div>
<div class=copyright>
<span class=power-by>
Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a>
</span>
<span class=division>|</span>
<span class=theme-info>
Theme - <a class=theme-link href=https://github.com/xianmin/hugo-theme-jane>Jane</a>
</span>
<span class=copyright-year>
&copy;
2020 -
2021
<span class=heart>
<i class=iconfont><svg class="icon" viewBox="0 0 1025 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14"><path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7.0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1.0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2.0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3.1-42.5-8-83.6-24-122.2z" fill="#8a8a8a"/></svg>
</i>
</span><span class=author>
Dave
</span></span>
</div>
</footer>
<div class=back-to-top id=back-to-top>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="35" height="35"><path d="M510.866688 227.694839 95.449397 629.218702h235.761562L329.15309 958.01517h362.40389L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777h894.052392v131.813095H63.840492V63.962777zm0 0"/></svg>
</i>
</div>
</div>
<script type=text/javascript src=/lib/jquery/jquery-3.2.1.min.js></script>
<script type=text/javascript src=/lib/slideout/slideout-1.0.1.min.js></script>
<script type=text/javascript src=/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/load-photoswipe.js></script>
<script type=text/javascript src=/lib/photoswipe/photoswipe.min.js></script>
<script type=text/javascript src=/lib/photoswipe/photoswipe-ui-default.min.js></script>
</body>
</html>