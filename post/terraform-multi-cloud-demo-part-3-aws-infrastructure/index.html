<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title>Terraform: Multi-cloud demo – Part 3 – AWS Infrastructure - Dave's DevOps blog</title>
<meta name=renderer content="webkit">
<meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes">
<meta name=MobileOptimized content="width">
<meta name=HandheldFriendly content="true">
<meta name=applicable-device content="pc,mobile">
<meta name=theme-color content="#f8f5ec">
<meta name=msapplication-navbutton-color content="#f8f5ec">
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec">
<meta name=mobile-web-app-capable content="yes">
<meta name=author content="Dave">
<meta name=description content="It&amp;rsquo;s going well so far. We have our source control defined and updated and our Terraform remote state hosted on Azure Storage which we provisioned using Terraform. Let&amp;rsquo;s now move onto provisioning our AWS infrastructure.
Root module main.tf First off we need to add the aws provider;
1 2 3 4  provider &amp;#34;aws&amp;#34; { region = var.region profile = var.profile }   You will notice that we have also used a couple of variables with this provider.">
<meta name=keywords content="Hugo,theme,jane">
<meta name=generator content="Hugo 0.88.0">
<link rel=canonical href=https://davehart.co.uk/post/terraform-multi-cloud-demo-part-3-aws-infrastructure/>
<link rel=icon href=/favicon.ico>
<link rel=stylesheet href=/sass/jane.min.fa4b2b9f31b5c6d0b683db81157a9226e17b06e61911791ab547242a4a0556f2.css integrity="sha256-+ksrnzG1xtC2g9uBFXqSJuF7BuYZEXkatUckKkoFVvI=" media=screen crossorigin=anonymous>
<meta property="og:title" content="Terraform: Multi-cloud demo – Part 3 – AWS Infrastructure">
<meta property="og:description" content="It&rsquo;s going well so far. We have our source control defined and updated and our Terraform remote state hosted on Azure Storage which we provisioned using Terraform. Let&rsquo;s now move onto provisioning our AWS infrastructure.
Root module main.tf First off we need to add the aws provider;
1 2 3 4  provider &#34;aws&#34; { region = var.region profile = var.profile }   You will notice that we have also used a couple of variables with this provider.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://davehart.co.uk/post/terraform-multi-cloud-demo-part-3-aws-infrastructure/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2021-04-09T11:23:40+00:00">
<meta property="article:modified_time" content="2021-04-09T11:23:40+00:00">
<meta itemprop=name content="Terraform: Multi-cloud demo – Part 3 – AWS Infrastructure">
<meta itemprop=description content="It&rsquo;s going well so far. We have our source control defined and updated and our Terraform remote state hosted on Azure Storage which we provisioned using Terraform. Let&rsquo;s now move onto provisioning our AWS infrastructure.
Root module main.tf First off we need to add the aws provider;
1 2 3 4  provider &#34;aws&#34; { region = var.region profile = var.profile }   You will notice that we have also used a couple of variables with this provider."><meta itemprop=datePublished content="2021-04-09T11:23:40+00:00">
<meta itemprop=dateModified content="2021-04-09T11:23:40+00:00">
<meta itemprop=wordCount content="1851">
<meta itemprop=keywords content="AWS,AWS,Blog,demo,modules,remote-state,Terraform,Terraform,"><meta name=twitter:card content="summary">
<meta name=twitter:title content="Terraform: Multi-cloud demo – Part 3 – AWS Infrastructure">
<meta name=twitter:description content="It&rsquo;s going well so far. We have our source control defined and updated and our Terraform remote state hosted on Azure Storage which we provisioned using Terraform. Let&rsquo;s now move onto provisioning our AWS infrastructure.
Root module main.tf First off we need to add the aws provider;
1 2 3 4  provider &#34;aws&#34; { region = var.region profile = var.profile }   You will notice that we have also used a couple of variables with this provider."><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]-->
</head>
<body>
<div id=mobile-navbar class=mobile-navbar>
<div class=mobile-header-logo>
<a href=/ class=logo>Dave's blog</a>
</div>
<div class=mobile-navbar-icon>
<span></span>
<span></span>
<span></span>
</div>
</div>
<nav id=mobile-menu class="mobile-menu slideout-menu">
<ul class=mobile-menu-list>
<li class=mobile-menu-item>
<a class=menu-item-link href=https://davehart.co.uk/>Home</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://davehart.co.uk/post/>Posts</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://davehart.co.uk/tags/>Tags</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://davehart.co.uk/privacy/>Privacy Policy</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://davehart.co.uk/about/>About</a>
</li>
</ul>
</nav>
<link rel=stylesheet href=/lib/photoswipe/photoswipe.min.css>
<link rel=stylesheet href=/lib/photoswipe/default-skin/default-skin.min.css>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div>
<header id=header class="header container">
<div class=logo-wrapper>
<a href=/ class=logo>
Dave's blog
</a>
</div>
<nav class=site-navbar>
<ul id=menu class=menu>
<li class=menu-item>
<a class=menu-item-link href=https://davehart.co.uk/>Home</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://davehart.co.uk/post/>Posts</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://davehart.co.uk/tags/>Tags</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://davehart.co.uk/privacy/>Privacy Policy</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://davehart.co.uk/about/>About</a>
</li>
</ul>
</nav>
</header>
<div id=mobile-panel>
<main id=main class="main bg-llight">
<div class=content-wrapper>
<div id=content class="content container">
<article class="post bg-white">
<header class=post-header>
<h1 class=post-title>Terraform: Multi-cloud demo – Part 3 – AWS Infrastructure</h1>
<div class=post-meta>
<time datetime=2021-04-09 class=post-time>
2021-04-09
</time>
<span class=more-meta> 1851 words </span>
<span class=more-meta> 9 min read </span>
</div>
</header>
<div class=post-toc id=post-toc>
<h2 class=post-toc-title>Table of Contents</h2>
<div class=post-toc-content>
<nav id=TableOfContents>
<ul>
<li><a href=#root-module>Root module</a>
<ul>
<li><a href=#maintf>main.tf</a></li>
<li><a href=#variablestf>variables.tf</a></li>
</ul>
</li>
<li><a href=#module---vpc>module - vpc</a></li>
<li><a href=#module--security-groups>module : security-groups</a></li>
<li><a href=#module--instance_profile>Module : instance_profile</a></li>
<li><a href=#summary>Summary</a></li>
</ul>
</nav>
</div>
</div>
<div class=post-content>
<p>It&rsquo;s going well so far. We have our <a href=/post/terraform-multi-cloud-demo-part-1-foundations/>source control defined and updated</a> and our Terraform remote state hosted on Azure Storage which we provisioned using Terraform. Let&rsquo;s now move onto provisioning our AWS infrastructure.</p>
<h2 id=root-module>Root module</h2>
<h3 id=maintf>main.tf</h3>
<p>First off we need to add the <a href=https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs>aws</a> provider;</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-HCL data-lang=HCL><span class=k>provider</span> <span class=s2>&#34;aws&#34;</span> {
<span class=n>  region</span>  <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>region</span>
<span class=n>  profile</span> <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>profile</span>
}
</code></pre></td></tr></table>
</div>
</div><p>You will notice that we have also used a couple of variables with this provider. The first will define our aws region and the second will tell the aws provider which profile to use. As I have numerous AWS account I am working in, I tend to use <a href=https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-profiles.html>named profiles</a> to define my security tokens. You can add secure tokens in the provider but that is a big no no. Especially as we are using a publicly accessible source control.</p>
<p>If you wanted to work across multiple accounts or regions you could add another aws provider and include an alias key. (e.g. alias = &ldquo;west1&rdquo;) which has its own configuration. You refer to this then using the &lsquo;provider = aws.alias&rsquo; value in your resources .</p>
<p>Let&rsquo;s add the variables into our root module variables.tf</p>
<h3 id=variablestf>variables.tf</h3>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-HCL data-lang=HCL><span class=k>variable</span> <span class=s2>&#34;region&#34;</span> {
<span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;aws region&#34;</span>
<span class=n>  type</span>        <span class=o>=</span> <span class=k>string</span>
<span class=n>  default</span>     <span class=o>=</span> <span class=s2>&#34;eu-west-2&#34;</span>
}
<span class=k>variable</span> <span class=s2>&#34;profile&#34;</span> {
<span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;aws user profile to utilise&#34;</span>
<span class=n>  type</span>        <span class=o>=</span> <span class=k>string</span>
<span class=n>  default</span>     <span class=o>=</span> <span class=s2>&#34;capgemini&#34;</span>
}
</code></pre></td></tr></table>
</div>
</div><p>Terraform has a number of ways of assigning variables values. We have used the default method in the above code block. If we omitted the default, terraform would prompt you when you apply your configuration for the value.</p>
<p>Alternatively we could create a terraform.tfvars file with the value declared, for example</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-HCL data-lang=HCL><span class=n>region</span> <span class=o>=</span> <span class=s2>&#34;eu-west-2&#34;</span>
<span class=n>profile</span> <span class=o>=</span> <span class=s2>&#34;capgemini&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>You will find that Terraform has many ways to handle variables. So <a href="https://learn.hashicorp.com/tutorials/terraform/variables?in=terraform/configuration-language">here</a> and <a href=https://www.terraform.io/docs/language/values/variables.html#variable-definition-precedence>here</a> are a few links worth reading; We will use different methods throughout this demo.</p>
<h2 id=module---vpc>module - vpc</h2>
<p>For our AWS infrastructure we are going to consume a module from the <a href=https://registry.terraform.io/>terraform registry</a>. If we navigate to the module and filter by AWS, the one we want is on the top of the list</p>
<figure>
<img sizes="(min-width: 35em) 1200px, 100vw" srcset="https://davehart.co.uk/post/terraform-multi-cloud-demo-part-3-aws-infrastructure/image-1_hu3853f915a5b99c1b99f956e672b80622_15893_480x0_resize_box_3.png 480w,
https://davehart.co.uk/post/terraform-multi-cloud-demo-part-3-aws-infrastructure/image-1_hu3853f915a5b99c1b99f956e672b80622_15893_800x0_resize_box_3.png 800w," src=https://davehart.co.uk/post/terraform-multi-cloud-demo-part-3-aws-infrastructure/image-1_hu3853f915a5b99c1b99f956e672b80622_15893_800x0_resize_box_3.png>
</figure>
<p>This is a <a href=https://registry.terraform.io/modules/terraform-aws-modules/vpc/aws/latest>module</a> verified by Terraform and provided by AWS. The module provides the below provisioning instructions.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-HCL data-lang=HCL><span class=k>module</span> <span class=s2>&#34;vpc&#34;</span> {
<span class=n>  source</span>  <span class=o>=</span> <span class=s2>&#34;terraform-aws-modules/vpc/aws&#34;</span>
<span class=n>  version</span> <span class=o>=</span> <span class=s2>&#34;2.77.0&#34;</span><span class=c1>
</span><span class=c1>  # insert the 49 required variables here
</span><span class=c1></span>}
</code></pre></td></tr></table>
</div>
</div><p>The module has over 400 inputs available so I am just going to show what we need for our deployment. I decided to use a data source for the availability zones. This allows us to fetch data from our aws provisioner relating to our region.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-HCL data-lang=HCL><span class=k>module</span> <span class=s2>&#34;vpc&#34;</span> {
<span class=n>  source</span>                   <span class=o>=</span> <span class=s2>&#34;terraform-aws-modules/vpc/aws&#34;</span>
<span class=n>  version</span>                  <span class=o>=</span> <span class=s2>&#34;2.77.0&#34;</span>
<span class=n>  cidr</span>                     <span class=o>=</span> <span class=s2>&#34;10.0.0.0/16&#34;</span>
<span class=n>  azs</span>                      <span class=o>=</span> <span class=k>data</span><span class=p>.</span><span class=k>aws_availability_zones</span><span class=p>.</span><span class=k>available</span><span class=p>.</span><span class=k>names</span>
<span class=n>  private_subnets</span>          <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;10.0.2.0/28&#34;, &#34;10.0.4.0/28&#34;</span><span class=p>]</span>
<span class=n>  public_subnets</span>           <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;10.0.1.0/28&#34;</span><span class=p>]</span>
<span class=n>  enable_dns_hostnames</span>     <span class=o>=</span> <span class=kt>true</span>
<span class=n>  enable_nat_gateway</span>       <span class=o>=</span> <span class=kt>true</span>
<span class=n>  single_nat_gateway</span>       <span class=o>=</span> <span class=kt>true</span>
<span class=n>  public_subnet_tags</span> <span class=o>=</span> {
<span class=n>    Name</span> <span class=o>=</span> <span class=s2>&#34;${var.env_prefix}-public&#34;</span>
  }
<span class=n>  tags</span> <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>tags</span>
<span class=n>  vpc_tags</span> <span class=o>=</span> {
<span class=n>    Name</span> <span class=o>=</span> <span class=s2>&#34;${var.env_prefix}-VPC&#34;</span>
  }
<span class=n>  private_subnet_tags</span> <span class=o>=</span> {
<span class=n>    Name</span> <span class=o>=</span> <span class=s2>&#34;${var.env_prefix}-private&#34;</span>
  }
<span class=n>  igw_tags</span> <span class=o>=</span> {
<span class=n>    Name</span> <span class=o>=</span> <span class=s2>&#34;${var.env_prefix}-igw&#34;</span>
  }
<span class=n>   nat_gateway_tags</span> <span class=o>=</span> {
<span class=n>    Name</span> <span class=o>=</span> <span class=s2>&#34;${var.env_prefix}-natgw&#34;</span>
  }
}

<span class=k>data</span> <span class=s2>&#34;aws_availability_zones&#34; &#34;available&#34;</span> {
<span class=n>  state</span> <span class=o>=</span> <span class=s2>&#34;available&#34;</span><span class=c1>         # Return all available az in the region
</span><span class=c1></span>}
</code></pre></td></tr></table>
</div>
</div><p>This is a pretty bare bones configuration. Lets break it down ignoring the provisioning defaults (source and version)</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-HCL data-lang=HCL><span class=n>cidr</span>                     <span class=o>=</span> <span class=s2>&#34;10.0.0.0/16&#34;</span><span class=c1>                               #VPC CIDR Range
</span><span class=c1></span><span class=n>azs</span>                      <span class=o>=</span> <span class=k>data</span><span class=p>.</span><span class=k>aws_availability_zones</span><span class=p>.</span><span class=k>available</span><span class=p>.</span><span class=k>names</span><span class=c1> # data block providing available az in region
</span><span class=c1></span><span class=n>private_subnets</span>          <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;10.0.2.0/28&#34;, &#34;10.0.4.0/28&#34;</span><span class=p>]</span><span class=c1>              # List of private subnets
</span><span class=c1></span><span class=n>public_subnets</span>           <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;10.0.1.0/28&#34;</span><span class=p>]</span><span class=c1>                             # List of public subnets
</span><span class=c1></span><span class=n>enable_dns_hostnames</span>     <span class=o>=</span> <span class=kt>true</span><span class=c1>                                        # Allow our instances to have name resolution
</span><span class=c1></span><span class=n>enable_nat_gateway</span>       <span class=o>=</span> <span class=kt>true</span><span class=c1>                                        # Create a nat gateway
</span><span class=c1></span><span class=n>single_nat_gateway</span>       <span class=o>=</span> <span class=kt>true</span><span class=c1>                                        # For the demo I am only having 1 nat gateway
</span></code></pre></td></tr></table>
</div>
</div><p>I am also defining a number of tags for each of the items using a combination of a tag variable and/or an env_prefix variable. We will define them in the root module variables.tf along with the region and profile variables.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-HCL data-lang=HCL><span class=k>variable</span> <span class=s2>&#34;tags&#34;</span> {
<span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;resource tags&#34;</span>
<span class=n>  type</span>        <span class=o>=</span> <span class=k>map</span><span class=p>(</span><span class=k>any</span><span class=p>)</span>
<span class=n>  default</span> <span class=o>=</span> {
    <span class=k>CostCentre</span> <span class=err>:</span> <span class=s2>&#34;common&#34;</span>
    <span class=k>Project</span> <span class=err>:</span> <span class=s2>&#34;infra&#34;</span>
    <span class=k>Description</span> <span class=err>:</span> <span class=s2>&#34;demo&#34;</span>
    <span class=k>Owner</span> <span class=err>:</span> <span class=s2>&#34;dave.hart&#34;</span>
  }
}
<span class=k>variable</span> <span class=s2>&#34;env_prefix&#34;</span> {
<span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;prefix for naming&#34;</span>
<span class=n>  type</span>        <span class=o>=</span> <span class=k>string</span>
<span class=n>  default</span>     <span class=o>=</span> <span class=s2>&#34;demo&#34;</span>
}
</code></pre></td></tr></table>
</div>
</div>
<figure style="padding:.25rem;margin:2rem 0;background-color:#fff">
<img style=max-width:100%;width:auto;height:auto src=/post/terraform-multi-cloud-demo-part-3-aws-infrastructure/info_hu90bf0207219454fdfafbb9c93dc105ef_65820_100x0_resize_q75_box.jpg width=100 height=100>
</figure>
<p><em><strong>type = map : The map variable type represents a collection of keys and values (key value pairs)</strong></em></p>
<p>That should cover our network infrastructure. Next up we start considering our two instances and what requirements we have for them.</p>
<p>Our two AWS EC2 instances will need a few different configuration components. I want them to be accessible via AWS systems manager so we can establish a session if required. We will achieve this by creating an instance profile/role which can be attached at the time of provisioning. Next the instances will need some security groups so we can access them and last of all we want to deploy the instances. When we deploy the EC2 instances we will be applying some user_data code to deploy our software and configure them. This is not necessarily a great use case for terraform as a single change to the user_data would result in the instance being redeployed. For software deployment and desired state there are tools more suited such as ansible or puppet to name a few. Seeing as this is a Terraform demo we will stick with using Terraform but you should consider different tools for any configuration management.</p>
<h2 id=module--security-groups>module : security-groups</h2>
<p>We will use an existing module from the terraform registry for our security groups. The second module in the registry under the AWS provisioner is for security groups;</p>
<figure>
<img sizes="(min-width: 35em) 1200px, 100vw" srcset="https://davehart.co.uk/post/terraform-multi-cloud-demo-part-3-aws-infrastructure/image-1_hu3853f915a5b99c1b99f956e672b80622_15893_480x0_resize_box_3.png 480w,
https://davehart.co.uk/post/terraform-multi-cloud-demo-part-3-aws-infrastructure/image-1_hu3853f915a5b99c1b99f956e672b80622_15893_800x0_resize_box_3.png 800w," src=https://davehart.co.uk/post/terraform-multi-cloud-demo-part-3-aws-infrastructure/image-1_hu3853f915a5b99c1b99f956e672b80622_15893_800x0_resize_box_3.png>
</figure>
<p>security-group module</p>
<p>If we take a look at the provisioning instructions it implied we do not need a lot of configuration;</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-HCL data-lang=HCL><span class=k>module</span> <span class=s2>&#34;security-group&#34;</span> {
<span class=n>  source</span>  <span class=o>=</span> <span class=s2>&#34;terraform-aws-modules/security-group/aws&#34;</span>
<span class=n>  version</span> <span class=o>=</span> <span class=s2>&#34;3.18.0&#34;</span><span class=c1>
</span><span class=c1>  # insert the 2 required variables here
</span><span class=c1></span>}
</code></pre></td></tr></table>
</div>
</div><p>We need a few more than the 2 required variables. We will be defining two SG, one for the proxy server and one for the Prometheus server. Here is our custom rules for the security groups with comments inline.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-HCL data-lang=HCL><span class=k>module</span> <span class=s2>&#34;security-group-prometheus&#34;</span> {
<span class=n>  source</span>  <span class=o>=</span> <span class=s2>&#34;terraform-aws-modules/security-group/aws&#34;</span>
<span class=n>  version</span> <span class=o>=</span> <span class=s2>&#34;3.18.0&#34;</span>
<span class=n>  name</span> <span class=o>=</span> <span class=s2>&#34;SGAllowPrometheus&#34;</span><span class=c1>                         # Name of the Security group
</span><span class=c1></span><span class=n>  vpc_id</span> <span class=o>=</span> <span class=k>module</span><span class=p>.</span><span class=k>vpc</span><span class=p>.</span><span class=k>vpc_id</span><span class=c1>                         # VPC Id using the value from the vpc module
</span><span class=c1></span><span class=n>  tags</span> <span class=o>=</span> <span class=k>merge</span><span class=p>(</span><span class=c1>                                      # Tagging - add the tag variables and merge with name
</span><span class=c1></span>    <span class=k>var</span><span class=p>.</span><span class=k>tags</span><span class=p>,</span> {
<span class=n>      Name</span> <span class=o>=</span> <span class=s2>&#34;SgAllowPrometheus&#34;</span>
  }<span class=p>)</span>
<span class=n>  ingress_with_cidr_blocks</span> <span class=o>=</span> <span class=p>[</span><span class=c1>                       # SG custom ingress rules for Prometheus server which is in 
</span><span class=c1></span>    {<span class=c1>                                                # a Private subnet
</span><span class=c1></span><span class=n>      from_port</span>   <span class=o>=</span> <span class=m>9090</span>
<span class=n>      to_port</span>     <span class=o>=</span> <span class=m>9100</span>
<span class=n>      protocol</span>    <span class=o>=</span> <span class=s2>&#34;tcp&#34;</span>
<span class=n>      cidr_blocks</span> <span class=o>=</span> <span class=s2>&#34;0.0.0.0/0&#34;</span>
    }<span class=p>,</span>
    {
<span class=n>      from_port</span>   <span class=o>=</span> <span class=m>9182</span>
<span class=n>      to_port</span>     <span class=o>=</span> <span class=m>9182</span>
<span class=n>      protocol</span>    <span class=o>=</span> <span class=s2>&#34;tcp&#34;</span>
<span class=n>      cidr_blocks</span> <span class=o>=</span> <span class=s2>&#34;0.0.0.0/0&#34;</span>
    }<span class=p>,]</span>
<span class=n>    egress_with_cidr_blocks</span> <span class=o>=</span> <span class=p>[</span><span class=c1>                      # SG Egress rules for Prometheus server
</span><span class=c1></span>    {
<span class=n>      from_port</span>   <span class=o>=</span> <span class=m>0</span>
<span class=n>      to_port</span>     <span class=o>=</span> <span class=m>0</span>
<span class=n>      protocol</span>    <span class=o>=</span> <span class=s2>&#34;-1&#34;</span>
<span class=n>      cidr_blocks</span> <span class=o>=</span> <span class=s2>&#34;0.0.0.0/0&#34;</span>
    }<span class=p>,</span>
  <span class=p>]</span>
}

<span class=k>module</span> <span class=s2>&#34;security-group-proxy&#34;</span> {
<span class=n>  source</span>  <span class=o>=</span> <span class=s2>&#34;terraform-aws-modules/security-group/aws&#34;</span>
<span class=n>  version</span> <span class=o>=</span> <span class=s2>&#34;3.18.0&#34;</span>
<span class=n>  name</span> <span class=o>=</span> <span class=s2>&#34;SgAllowProxy&#34;</span><span class=c1>                             # Name of the Security group
</span><span class=c1></span><span class=n>  vpc_id</span> <span class=o>=</span> <span class=k>module</span><span class=p>.</span><span class=k>vpc</span><span class=p>.</span><span class=k>vpc_id</span><span class=c1>                        # VPC Id using the value from the vpc module
</span><span class=c1></span><span class=n>  tags</span> <span class=o>=</span> <span class=k>merge</span><span class=p>(</span><span class=c1>                                     # Tagging - add the tag variables and merge with name
</span><span class=c1></span>    <span class=k>var</span><span class=p>.</span><span class=k>tags</span><span class=p>,</span> {
<span class=n>      Name</span> <span class=o>=</span> <span class=s2>&#34;SgAllowProxy&#34;</span>
  }<span class=p>)</span>
<span class=n>  ingress_cidr_blocks</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;0.0.0.0/0&#34;</span><span class=p>]</span><span class=c1>               # SG predefined ingress rules for Proxy server which is in 
</span><span class=c1></span><span class=n>  ingress_rules</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;http-80-tcp&#34;</span><span class=p>]</span><span class=c1>                   # a public subnet
</span><span class=c1></span><span class=n>  egress_with_cidr_blocks</span> <span class=o>=</span> <span class=p>[</span>
    {
<span class=n>      from_port</span>   <span class=o>=</span> <span class=m>0</span>
<span class=n>      to_port</span>     <span class=o>=</span> <span class=m>0</span>
<span class=n>      protocol</span>    <span class=o>=</span> <span class=s2>&#34;-1&#34;</span>
<span class=n>      cidr_blocks</span> <span class=o>=</span> <span class=s2>&#34;0.0.0.0/0&#34;</span>
    }<span class=p>,</span>
  <span class=p>]</span>
}
</code></pre></td></tr></table>
</div>
</div><p>Now we need to define our EC2 instance profile.</p>
<h2 id=module--instance_profile>Module : instance_profile</h2>
<p>This will be a module we create, so lets start off creating a folder under the modules folder for our configuration. We will call this one modules/instance_profile</p>
<p>next we can define our modules main.tf and add the terraform configuration block defining the minimum required version and the resources we need for the instance profile/role.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-HCL data-lang=HCL><span class=k>terraform</span> {
<span class=n>    required_version</span> <span class=o>=</span><span class=n> &#34;&gt;</span><span class=o>=</span><span class=m>0</span><span class=p>.</span><span class=m>14</span><span class=p>.</span><span class=m>8</span><span class=err>&#34;</span>
}
                                   
<span class=k>resource</span> <span class=s2>&#34;aws_iam_role&#34; &#34;demo-ssm-role&#34;</span> {<span class=c1>               # Define our resource role for systems manager
</span><span class=c1></span><span class=n>  name</span> <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>role_name</span><span class=c1>                                  # the role name from a variables
</span><span class=c1></span><span class=n>  assume_role_policy</span> <span class=o>=</span> <span class=k>jsonencode</span><span class=p>(</span>{<span class=c1>                     # use jsonencode to format the role policy to a string
</span><span class=c1></span><span class=n>    Version</span> <span class=o>=</span> <span class=s2>&#34;2012-10-17&#34;</span>
<span class=n>    Statement</span> <span class=o>=</span> <span class=p>[</span>
      {
<span class=n>        Action</span> <span class=o>=</span> <span class=s2>&#34;sts:AssumeRole&#34;</span>
<span class=n>        Effect</span> <span class=o>=</span> <span class=s2>&#34;Allow&#34;</span>
<span class=n>        Sid</span>    <span class=o>=</span> <span class=s2>&#34;&#34;</span>
<span class=n>        Principal</span> <span class=o>=</span> {
<span class=n>          Service</span> <span class=o>=</span> <span class=s2>&#34;ec2.amazonaws.com&#34;</span>
        }
      }
    <span class=p>]</span>
  }<span class=p>)</span>
<span class=n>  tags</span> <span class=o>=</span> <span class=k>merge</span><span class=p>(</span>
    <span class=k>var</span><span class=p>.</span><span class=k>tags</span><span class=p>,</span> {
<span class=n>      Name</span> <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>tag_name</span>
  }<span class=p>)</span>
}

<span class=k>resource</span> <span class=s2>&#34;aws_iam_instance_profile&#34; &#34;ec2_profile&#34;</span> {
<span class=n>  name</span> <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>ip_name</span><span class=c1>                                      # variable to define the instance profile name
</span><span class=c1></span><span class=n>  role</span> <span class=o>=</span> <span class=k>aws_iam_role</span><span class=p>.</span><span class=k>demo</span><span class=err>-</span><span class=k>ssm</span><span class=err>-</span><span class=k>role</span><span class=p>.</span><span class=k>name</span><span class=c1>                  # which role is associated with the instance profile
</span><span class=c1></span>}

<span class=k>resource</span> <span class=s2>&#34;aws_iam_role_policy_attachment&#34; &#34;ssm-attach&#34;</span> {<span class=c1>  # define which existing policies to attach to the the role
</span><span class=c1></span><span class=n>  role</span>       <span class=o>=</span> <span class=k>aws_iam_role</span><span class=p>.</span><span class=k>demo</span><span class=err>-</span><span class=k>ssm</span><span class=err>-</span><span class=k>role</span><span class=p>.</span><span class=k>name</span><span class=c1>            # name of the role
</span><span class=c1></span><span class=n>  count</span>      <span class=o>=</span> <span class=k>length</span><span class=p>(</span><span class=k>var</span><span class=p>.</span><span class=k>policy_arns</span><span class=p>)</span><span class=c1>                    # loop through each policy arn defined in the variable
</span><span class=c1></span><span class=n>  policy_arn</span> <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>policy_arns</span><span class=p>[</span><span class=k>count</span><span class=p>.</span><span class=k>index</span><span class=p>]</span>
}
</code></pre></td></tr></table>
</div>
</div><p>Now lets define our variables.tf for the instance_profile module</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-HCL data-lang=HCL><span class=k>variable</span> <span class=s2>&#34;ip_name&#34;</span> {
<span class=n>    type</span> <span class=o>=</span> <span class=k>string</span><span class=c1>                # instance profile name
</span><span class=c1></span><span class=n>    default</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
}
<span class=k>variable</span> <span class=s2>&#34;role_name&#34;</span> {<span class=c1>           # role name
</span><span class=c1></span><span class=n>    type</span> <span class=o>=</span> <span class=k>string</span>
<span class=n>    default</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
}
<span class=k>variable</span> <span class=s2>&#34;tag_name&#34;</span> {<span class=c1>            # tag name key value
</span><span class=c1></span><span class=n>    type</span> <span class=o>=</span> <span class=k>string</span>
<span class=n>    default</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
}
<span class=k>variable</span> <span class=s2>&#34;policy_arns&#34;</span> {<span class=c1>         # list of arns to attach to the role
</span><span class=c1></span><span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;arns to add to ec2 role&#34;</span>
<span class=n>  type</span>        <span class=o>=</span> <span class=k>list</span><span class=p>(</span><span class=k>any</span><span class=p>)</span>
<span class=n>  default</span>     <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;&#34;</span><span class=p>]</span>
}
<span class=k>variable</span> <span class=s2>&#34;tags&#34;</span> {<span class=c1>                # tags to apply
</span><span class=c1></span><span class=n>  description</span> <span class=o>=</span> <span class=s2>&#34;resource tags&#34;</span>
<span class=n>  type</span>        <span class=o>=</span> <span class=k>map</span><span class=p>(</span><span class=k>any</span><span class=p>)</span>
<span class=n>  default</span> <span class=o>=</span> {}
}
</code></pre></td></tr></table>
</div>
</div><p>For this module we need to know the instance profile name so we can use it for our EC2 instances role attachment. To retrieve this value we will define an output value in the output.tf file within the module path;</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-HCL data-lang=HCL><span class=k>output</span> <span class=s2>&#34;iam_instance_profile_name&#34;</span> {
<span class=n>    value</span> <span class=o>=</span> <span class=k>aws_iam_instance_profile</span><span class=p>.</span><span class=k>ec2_profile</span><span class=p>.</span><span class=k>name</span>
}
</code></pre></td></tr></table>
</div>
</div><p>Next we need to call this module from our root module defining the few required values we setup;</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-HCL data-lang=HCL><span class=k>module</span> <span class=s2>&#34;instance_profile&#34;</span> {
<span class=n>  source</span>      <span class=o>=</span> <span class=s2>&#34;./modules/instance_profile&#34;</span><span class=c1>                             # where we created our configuration
</span><span class=c1></span><span class=n>  ip_name</span>     <span class=o>=</span> <span class=s2>&#34;demo_ec2_profile&#34;</span><span class=c1>                                       # instance profile name
</span><span class=c1></span><span class=n>  role_name</span>   <span class=o>=</span> <span class=s2>&#34;demo_ssm_role&#34;</span><span class=c1>                                          # role name
</span><span class=c1></span><span class=n>  policy_arns</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore&#34;</span><span class=p>]</span><span class=c1> # list of policy arn to attach
</span><span class=c1></span><span class=n>  tag_name</span>    <span class=o>=</span> <span class=s2>&#34;demo-ec2-ssm-policy&#34;</span><span class=c1>                                    # the tag key name value
</span><span class=c1></span><span class=n>  tags</span>        <span class=o>=</span> <span class=k>var</span><span class=p>.</span><span class=k>tags</span><span class=c1>                                                 # pass the root module tag variable values
</span><span class=c1></span>}
</code></pre></td></tr></table>
</div>
</div><p>Security groups and instance profile defined.</p>
<h2 id=summary>Summary</h2>
<p>It&rsquo;s getting a bit long so lets wrap up for now. We have successfully defined our AWS Network components, security groups and instance profile ready for our instances.</p>
<p>In <a href=/post/terraform-multi-cloud-demo-part-4-aws-instances/>part 4</a> we will continue to deploy our AWS EC2 instances</p>
<p>Disclaimer: You may incur costs if you follow along with the exercise. Use at your own risk!</p>
</div>
<footer class=post-footer>
<div class=post-tags>
<a href=https://davehart.co.uk/tags/aws/>AWS</a>
<a href=https://davehart.co.uk/tags/aws/>AWS</a>
<a href=https://davehart.co.uk/tags/blog/>Blog</a>
<a href=https://davehart.co.uk/tags/demo/>demo</a>
<a href=https://davehart.co.uk/tags/modules/>modules</a>
<a href=https://davehart.co.uk/tags/remote-state/>remote-state</a>
<a href=https://davehart.co.uk/tags/terraform/>Terraform</a>
<a href=https://davehart.co.uk/tags/terraform/>Terraform</a>
</div>
<nav class=post-nav>
<a class=prev href=/post/terraform-multi-cloud-demo-part-4-aws-instances/>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417l277.93508-310.326815c11.338233-12.190647 11.035334-32.285311-.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"/></svg>
</i>
<span class="prev-text nav-default">Terraform: Multi-cloud demo – Part 4 – AWS Instances</span>
<span class="prev-text nav-mobile">Prev</span>
</a>
<a class=next href=/post/terraform-multi-cloud-demo-part-2-terraform-remote-state-on-azure/>
<span class="next-text nav-default">Terraform: Multi-cloud demo – Part 2 – Terraform Remote State on Azure</span>
<span class="prev-text nav-mobile">Next</span>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697c-11.777231-11.500939-30.216186-10.304694-41.178865 2.712784z"/></svg>
</i>
</a>
</nav>
</footer>
</article>
</div>
</div>
</main>
<footer id=footer class=footer>
<div class=icon-links>
<a href=https://twitter.com/daveihart rel="me noopener" class=iconfont title=twitter target=_blank><svg class="icon" viewBox="0 0 1264 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M1229.8616 18.043658s-117.852626 63.135335-164.151872 67.344358C960.484169-78.763856 560.627046-7.210476 627.971403 308.466201 278.622548 312.675223 89.216542 47.506814 89.216542 47.506814S-28.636084 236.91282 164.978944 392.646647C127.097743 396.85567 55.544363 371.601535 55.544363 371.601535S26.081207 535.753407 253.368414 615.724832c-21.045112 29.463156-113.643603 8.418045-113.643603 8.418045s25.254134 143.10676 231.496229 180.987961c-143.10676 130.479693-387.230056 92.598492-370.393967 105.225559 206.242095 189.406006 1119.599946 231.496229 1128.01799-643.98042 50.5082679999998-16.83609 134.688715-143.10676 134.688715-143.10676s-130.479693 37.881201-138.897738 33.672179C1225.652577 98.015083 1229.8616 18.043658 1229.8616 18.043658"/></svg>
</a>
<a href=https://www.linkedin.com/in/dave-hart/ rel="me noopener" class=iconfont title=linkedin target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="33" height="33"><path d="M872.405333 872.618667H720.768V635.008c0-56.661333-1.152-129.578667-79.018667-129.578667-79.061333.0-91.136 61.653333-91.136 125.397334v241.792H398.976V384H544.64v66.602667h1.962667c20.352-38.4 69.845333-78.933333 143.786666-78.933334 153.642667.0 182.058667 101.12 182.058667 232.746667v268.202667zM227.712 317.141333a87.978667 87.978667.0 01-88.021333-88.106666A88.064 88.064.0 11227.712 317.141333zm76.032 555.477334H151.68V384h152.064v488.618667zM948.266667.0h-872.704C33.792.0.0 33.024.0 73.770667v876.458666C0 991.018667 33.792 1024 75.562667 1024h872.576C989.866667 1024 1024 991.018667 1024 950.229333V73.770667C1024 33.024 989.866667.0 948.138667.0h.128z"/></svg>
</a>
<a href=https://github.com/daveihart rel="me noopener" class=iconfont title=github target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M512 12.672c-282.88.0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667.0-12.16-.426667-44.373333-.64-87.04C242.005334 929.664 211.968 830.08 211.968 830.08 188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333.0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333.0.0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667.0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72.0 68.522667-.64 123.562667-.64 140.202666.0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"/></svg>
</a>
<a href=https://davehart.co.uk/index.xml rel="noopener alternate" type=application/rss+xml class=iconfont title=rss target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30"><path d="M819.157333 1024C819.157333 574.592 449.408 204.8.0 204.8V0c561.706667.0 1024 462.293333 1024 1024H819.157333zM140.416 743.04a140.8 140.8.0 01140.501333 140.586667A140.928 140.928.0 01140.074667 1024C62.72 1024 0 961.109333.0 883.626667S62.933333 743.082667 140.416 743.04zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667v-199.04c372.352.0 678.784 306.517333 678.784 678.826667z"/></svg>
</a>
</div>
<div class=copyright>
<span class=power-by>
Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a>
</span>
<span class=division>|</span>
<span class=theme-info>
Theme - <a class=theme-link href=https://github.com/xianmin/hugo-theme-jane>Jane</a>
</span>
<span class=copyright-year>
&copy;
2020 -
2021
<span class=heart>
<i class=iconfont><svg class="icon" viewBox="0 0 1025 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14"><path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7.0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1.0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2.0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3.1-42.5-8-83.6-24-122.2z" fill="#8a8a8a"/></svg>
</i>
</span><span class=author>
Dave
</span></span>
</div>
</footer>
<div class=back-to-top id=back-to-top>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="35" height="35"><path d="M510.866688 227.694839 95.449397 629.218702h235.761562L329.15309 958.01517h362.40389L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777h894.052392v131.813095H63.840492V63.962777zm0 0"/></svg>
</i>
</div>
</div>
<script type=text/javascript src=/lib/jquery/jquery-3.2.1.min.js></script>
<script type=text/javascript src=/lib/slideout/slideout-1.0.1.min.js></script>
<script type=text/javascript src=/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/load-photoswipe.js></script>
<script type=text/javascript src=/lib/photoswipe/photoswipe.min.js></script>
<script type=text/javascript src=/lib/photoswipe/photoswipe-ui-default.min.js></script>
</body>
</html>